<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#D71920">
    <title>Lanxess Safety AR - Animaci√≥n Educativa</title>

    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Exo+2:wght@400;700&family=Roboto:wght@400;700&display=swap');

        :root {
            --primary-red: #D71920;
            --deep-black: #0a0a0a;
            --pure-white: #ffffff;
            --safe: #34c759;
            --font-display: 'Orbitron', monospace;
            --font-heading: 'Exo 2', sans-serif;
            --font-body: 'Roboto', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            position: fixed;
            overflow: hidden;
            background: #000;
        }

        #cameraVideo {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
            display: none;
        }

        .controls-overlay {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--primary-red);
            border-radius: 12px;
            padding: 15px 20px;
            font-family: var(--font-body);
            color: white;
            pointer-events: none;
        }

        .controls-overlay h3 {
            font-family: var(--font-display);
            font-size: 14px;
            color: var(--primary-red);
            margin-bottom: 10px;
        }

        .controls-overlay p {
            font-size: 11px;
            margin: 5px 0;
            opacity: 0.9;
        }

        .hud-info {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--primary-red);
            border-radius: 12px;
            padding: 15px 20px;
            font-family: var(--font-body);
            min-width: 180px;
        }

        .hud-label {
            font-family: var(--font-heading);
            font-size: 10px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .hud-value {
            font-family: var(--font-display);
            font-size: 32px;
            font-weight: 900;
            color: var(--primary-red);
            text-shadow: 0 0 15px rgba(215, 25, 32, 0.8);
            line-height: 1;
            margin-bottom: 8px;
        }

        .hud-value.safe {
            color: var(--safe);
            text-shadow: 0 0 15px rgba(52, 199, 89, 0.8);
        }

        .hud-status {
            font-size: 12px;
            color: white;
            font-weight: 600;
        }

        .hud-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }

        .hud-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary-red), #ff6b6b);
            transition: width 0.3s;
        }

        .bottom-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.9);
            padding: 25px 20px calc(env(safe-area-inset-bottom, 20px) + 20px);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            pointer-events: auto;
        }

        .status-text {
            font-family: var(--font-heading);
            font-size: 15px;
            color: white;
            text-align: center;
            min-height: 22px;
        }

        .btn-control {
            width: 100%;
            max-width: 340px;
            padding: 18px 28px;
            background: var(--primary-red);
            color: white;
            border: none;
            border-radius: 50px;
            font-family: var(--font-heading);
            font-size: 15px;
            font-weight: 900;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 6px 25px rgba(215, 25, 32, 0.5);
        }

        .btn-control:active {
            transform: scale(0.96);
        }

        .btn-control.secondary {
            background: #555;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.5);
        }

        .btn-control.success {
            background: var(--safe);
            box-shadow: 0 6px 25px rgba(52, 199, 89, 0.5);
        }

        .btn-control:disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .danger-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 500;
            display: none;
            animation: dangerPulse 1.5s infinite;
        }

        .danger-overlay.active {
            display: block;
        }

        @keyframes dangerPulse {
            0%, 100% { box-shadow: inset 0 0 0 rgba(215, 25, 32, 0); }
            50% { box-shadow: inset 0 0 120px rgba(215, 25, 32, 0.6); }
        }

        #arScene {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            z-index: 5 !important;
        }

        .a-enter-vr, .a-orientation-modal {
            display: none !important;
        }
    </style>
</head>
<body>

    <video id="cameraVideo" playsinline autoplay muted></video>
    <div id="dangerOverlay" class="danger-overlay"></div>

    <div class="controls-overlay">
        <h3>üéÆ CONTROLES</h3>
        <p>üì± Arrastra para rotar c√°mara</p>
        <p>üîç Pinch para zoom</p>
        <p>üé¨ Explora la escena 360¬∞</p>
    </div>

    <div class="hud-info">
        <div class="hud-label">Nivel de Ruido</div>
        <div class="hud-value" id="hudDbValue">0 dB</div>
        <div class="hud-status" id="hudStatus">Esperando...</div>
        <div class="hud-bar">
            <div class="hud-fill" id="hudFill"></div>
        </div>
    </div>

    <div class="bottom-controls">
        <div class="status-text" id="statusText">Mueve la c√°mara para explorar la escena</div>
        <button id="btnStartAnimation" class="btn-control">üé¨ INICIAR ANIMACI√ìN</button>
        <button id="btnResetCamera" class="btn-control secondary" style="display: none;">üîÑ REINICIAR C√ÅMARA</button>
    </div>

    <a-scene 
        id="arScene"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; antialias: true; alpha: true; colorManagement: true;"
        loading-screen="enabled: false"
        embedded
        background="transparent">

        <!-- C√ÅMARA CON CONTROLES -->
        <a-camera 
            id="mainCamera" 
            position="0 1.6 5"
            look-controls="enabled: true; touchEnabled: true; mouseEnabled: true; pointerLockEnabled: false"
            wasd-controls="enabled: false">
        </a-camera>

        <!-- ILUMINACI√ìN PROFESIONAL -->
        <a-entity light="type: ambient; color: #FFF; intensity: 0.6"></a-entity>
        <a-entity light="type: directional; color: #FFF; intensity: 1.2" position="5 8 3" 
                  light="castShadow: true"></a-entity>
        <a-entity light="type: directional; color: #FFF; intensity: 0.8" position="-5 6 -3"></a-entity>
        <a-entity id="dangerLight" light="type: point; color: #D71920; intensity: 0; distance: 15" 
                  position="0 2 0"></a-entity>

        <!-- SUELO CON SOMBRAS -->
        <a-plane 
            position="0 0 0" 
            rotation="-90 0 0" 
            width="20" 
            height="20" 
            color="#1a1a1a"
            shadow="receive: true"
            material="roughness: 0.8">
        </a-plane>

        <!-- ESCENARIO PRINCIPAL -->
        <a-entity id="mainScene">

            <!-- MESA PROCEDURAL -->
            <a-entity id="mesa" position="2.5 0 0">
                <!-- Tablero -->
                <a-box 
                    width="1.5" 
                    height="0.1" 
                    depth="0.8" 
                    position="0 0.8 0"
                    color="#8B4513"
                    shadow="cast: true"
                    material="roughness: 0.7; metalness: 0.2">
                </a-box>
                
                <!-- Patas -->
                <a-cylinder radius="0.04" height="0.8" color="#654321" position="-0.6 0.4 -0.3"></a-cylinder>
                <a-cylinder radius="0.04" height="0.8" color="#654321" position="0.6 0.4 -0.3"></a-cylinder>
                <a-cylinder radius="0.04" height="0.8" color="#654321" position="-0.6 0.4 0.3"></a-cylinder>
                <a-cylinder radius="0.04" height="0.8" color="#654321" position="0.6 0.4 0.3"></a-cylinder>
            </a-entity>

            <!-- AURICULARES PROCEDURALES -->
            <a-entity id="headphones" position="2.5 0.95 0">
                <!-- Banda superior -->
                <a-torus 
                    radius="0.18" 
                    radius-tubular="0.02" 
                    color="#2a2a2a"
                    rotation="0 0 0"
                    arc="180"
                    material="metalness: 0.8; roughness: 0.3">
                </a-torus>
                
                <!-- Auricular izquierdo -->
                <a-entity position="-0.18 -0.08 0">
                    <a-cylinder radius="0.08" height="0.04" color="#1a1a1a" 
                                rotation="90 0 0" material="metalness: 0.6; roughness: 0.4"></a-cylinder>
                    <a-sphere radius="0.07" color="#2a2a2a" 
                              material="metalness: 0.5; roughness: 0.5"></a-sphere>
                    <a-circle radius="0.04" color="#D71920" position="0 0 0.072" 
                              material="emissive: #D71920; emissiveIntensity: 0.5"></a-circle>
                </a-entity>
                
                <!-- Auricular derecho -->
                <a-entity position="0.18 -0.08 0">
                    <a-cylinder radius="0.08" height="0.04" color="#1a1a1a" 
                                rotation="90 0 0" material="metalness: 0.6; roughness: 0.4"></a-cylinder>
                    <a-sphere radius="0.07" color="#2a2a2a" 
                              material="metalness: 0.5; roughness: 0.5"></a-sphere>
                    <a-circle radius="0.04" color="#D71920" position="0 0 0.072" 
                              material="emissive: #D71920; emissiveIntensity: 0.5"></a-circle>
                </a-entity>
                
                <!-- Brillo indicador -->
                <a-entity 
                    light="type: point; color: #00FF00; intensity: 0.8; distance: 1"
                    position="0 0.1 0"
                    animation="property: light.intensity; from: 0.8; to: 0.3; dir: alternate; dur: 1000; loop: true">
                </a-entity>
                
                <!-- Animaci√≥n flotante -->
                <a-animation
                    attribute="position"
                    from="2.5 0.95 0"
                    to="2.5 1.05 0"
                    direction="alternate"
                    dur="2000"
                    repeat="indefinite"
                    easing="easeInOutSine">
                </a-animation>
            </a-entity>

            <!-- STICKMAN ARTICULADO -->
            <a-entity id="stickman" position="0 0 0">
                
                <!-- BASE / PELVIS -->
                <a-entity id="pelvis" position="0 0.95 0">
                    <a-sphere radius="0.06" color="#FFE0BD"></a-sphere>
                    
                    <!-- COLUMNA -->
                    <a-entity id="spine" position="0 0.35 0">
                        <a-cylinder radius="0.04" height="0.6" color="#4A90E2"></a-cylinder>
                        
                        <!-- CUELLO -->
                        <a-entity id="neck" position="0 0.35 0">
                            <a-cylinder radius="0.03" height="0.1" color="#FFE0BD"></a-cylinder>
                            
                            <!-- CABEZA -->
                            <a-entity id="head" position="0 0.15 0">
                                <a-sphere radius="0.15" color="#FFE0BD" shadow="cast: true"></a-sphere>
                                
                                <!-- Ojos -->
                                <a-sphere radius="0.02" color="#000" position="-0.05 0.03 0.14"></a-sphere>
                                <a-sphere radius="0.02" color="#000" position="0.05 0.03 0.14"></a-sphere>
                                
                                <!-- Boca (cambia seg√∫n estado) -->
                                <a-entity id="mouth">
                                    <a-torus radius="0.04" radius-tubular="0.008" color="#000" 
                                             position="0 -0.03 0.14" rotation="0 0 0" arc="180"></a-torus>
                                </a-entity>
                            </a-entity>
                        </a-entity>
                        
                        <!-- HOMBROS -->
                        <a-entity id="shoulders" position="0 0.28 0">
                            
                            <!-- BRAZO IZQUIERDO -->
                            <a-entity id="leftShoulder" position="-0.15 0 0" rotation="0 0 20">
                                <a-sphere radius="0.04" color="#FFE0BD"></a-sphere>
                                
                                <a-entity id="leftUpperArm" rotation="0 0 0">
                                    <a-cylinder radius="0.03" height="0.3" color="#4A90E2" 
                                               position="0 -0.15 0"></a-cylinder>
                                    
                                    <a-entity id="leftElbow" position="0 -0.3 0">
                                        <a-sphere radius="0.035" color="#FFE0BD"></a-sphere>
                                        
                                        <a-entity id="leftForearm" rotation="0 0 0">
                                            <a-cylinder radius="0.025" height="0.3" color="#FFE0BD" 
                                                       position="0 -0.15 0"></a-cylinder>
                                            
                                            <a-entity id="leftHand" position="0 -0.3 0">
                                                <a-sphere radius="0.04" color="#FFE0BD"></a-sphere>
                                            </a-entity>
                                        </a-entity>
                                    </a-entity>
                                </a-entity>
                            </a-entity>
                            
                            <!-- BRAZO DERECHO -->
                            <a-entity id="rightShoulder" position="0.15 0 0" rotation="0 0 -20">
                                <a-sphere radius="0.04" color="#FFE0BD"></a-sphere>
                                
                                <a-entity id="rightUpperArm" rotation="0 0 0">
                                    <a-cylinder radius="0.03" height="0.3" color="#4A90E2" 
                                               position="0 -0.15 0"></a-cylinder>
                                    
                                    <a-entity id="rightElbow" position="0 -0.3 0">
                                        <a-sphere radius="0.035" color="#FFE0BD"></a-sphere>
                                        
                                        <a-entity id="rightForearm" rotation="0 0 0">
                                            <a-cylinder radius="0.025" height="0.3" color="#FFE0BD" 
                                                       position="0 -0.15 0"></a-cylinder>
                                            
                                            <a-entity id="rightHand" position="0 -0.3 0">
                                                <a-sphere radius="0.04" color="#FFE0BD"></a-sphere>
                                            </a-entity>
                                        </a-entity>
                                    </a-entity>
                                </a-entity>
                            </a-entity>
                        </a-entity>
                    </a-entity>
                    
                    <!-- PIERNA IZQUIERDA -->
                    <a-entity id="leftHip" position="-0.08 -0.05 0" rotation="0 0 5">
                        <a-sphere radius="0.04" color="#FFE0BD"></a-sphere>
                        
                        <a-entity id="leftThigh" rotation="0 0 0">
                            <a-cylinder radius="0.035" height="0.4" color="#2C3E50" 
                                       position="0 -0.2 0"></a-cylinder>
                            
                            <a-entity id="leftKnee" position="0 -0.4 0">
                                <a-sphere radius="0.04" color="#FFE0BD"></a-sphere>
                                
                                <a-entity id="leftCalf" rotation="0 0 0">
                                    <a-cylinder radius="0.03" height="0.4" color="#2C3E50" 
                                               position="0 -0.2 0"></a-cylinder>
                                    
                                    <a-entity id="leftFoot" position="0 -0.4 0">
                                        <a-box width="0.08" height="0.04" depth="0.12" 
                                               color="#1a1a1a" position="0 -0.02 0.02"></a-box>
                                    </a-entity>
                                </a-entity>
                            </a-entity>
                        </a-entity>
                    </a-entity>
                    
                    <!-- PIERNA DERECHA -->
                    <a-entity id="rightHip" position="0.08 -0.05 0" rotation="0 0 -5">
                        <a-sphere radius="0.04" color="#FFE0BD"></a-sphere>
                        
                        <a-entity id="rightThigh" rotation="0 0 0">
                            <a-cylinder radius="0.035" height="0.4" color="#2C3E50" 
                                       position="0 -0.2 0"></a-cylinder>
                            
                            <a-entity id="rightKnee" position="0 -0.4 0">
                                <a-sphere radius="0.04" color="#FFE0BD"></a-sphere>
                                
                                <a-entity id="rightCalf" rotation="0 0 0">
                                    <a-cylinder radius="0.03" height="0.4" color="#2C3E50" 
                                               position="0 -0.2 0"></a-cylinder>
                                    
                                    <a-entity id="rightFoot" position="0 -0.4 0">
                                        <a-box width="0.08" height="0.04" depth="0.12" 
                                               color="#1a1a1a" position="0 -0.02 0.02"></a-box>
                                    </a-entity>
                                </a-entity>
                            </a-entity>
                        </a-entity>
                    </a-entity>
                </a-entity>
            </a-entity>

            <!-- ONDAS DE RUIDO VISUALES -->
            <a-entity id="soundWaves" position="0 1.5 0" visible="false">
                <a-torus radius="0.5" radius-tubular="0.05" color="#FF0000" opacity="0.6" rotation="90 0 0">
                    <a-animation attribute="scale" from="0.5 0.5 0.5" to="2.5 2.5 2.5" 
                                dur="1500" repeat="indefinite"></a-animation>
                    <a-animation attribute="opacity" from="0.6" to="0" 
                                dur="1500" repeat="indefinite"></a-animation>
                </a-torus>
                
                <a-torus radius="0.5" radius-tubular="0.05" color="#FF0000" opacity="0.6" rotation="90 0 0">
                    <a-animation attribute="scale" from="0.5 0.5 0.5" to="2.5 2.5 2.5" 
                                dur="1500" delay="500" repeat="indefinite"></a-animation>
                    <a-animation attribute="opacity" from="0.6" to="0" 
                                dur="1500" delay="500" repeat="indefinite"></a-animation>
                </a-torus>
                
                <a-torus radius="0.5" radius-tubular="0.05" color="#FF0000" opacity="0.6" rotation="90 0 0">
                    <a-animation attribute="scale" from="0.5 0.5 0.5" to="2.5 2.5 2.5" 
                                dur="1500" delay="1000" repeat="indefinite"></a-animation>
                    <a-animation attribute="opacity" from="0.6" to="0" 
                                dur="1500" delay="1000" repeat="indefinite"></a-animation>
                </a-torus>
            </a-entity>

            <!-- TEXTO INFORMATIVO 3D -->
            <a-entity id="infoText" position="0 2.5 0" look-at="#mainCamera" visible="false">
                <a-plane width="2.5" height="0.8" color="#000000" opacity="0.95"></a-plane>
                <a-plane width="2.4" height="0.7" color="#D71920" position="0 0 0.01"></a-plane>
                <a-plane width="2.3" height="0.6" color="#000000" opacity="0.95" position="0 0 0.02"></a-plane>
                
                <a-text 
                    id="infoTextContent"
                    value="‚ö†Ô∏è 105 dB - PELIGRO ‚ö†Ô∏è"
                    color="#FFFF00"
                    align="center"
                    width="2.8"
                    position="0 0.15 0.05"
                    font="roboto">
                </a-text>
                
                <a-text 
                    id="infoTextSub"
                    value="Nivel da√±ino para audici√≥n"
                    color="#FFFFFF"
                    align="center"
                    width="2.5"
                    position="0 -0.15 0.05"
                    font="roboto">
                </a-text>
            </a-entity>

            <!-- PART√çCULAS DE ESTR√âS -->
            <a-entity 
                id="stressParticles"
                position="0 1.5 0"
                visible="false"
                particle-system="preset: dust; color: #FF0000,#FF6B6B; particleCount: 100; 
                                 size: 0.03; maxAge: 2; velocityValue: 0.5 0.5 0.5; 
                                 velocitySpread: 0.3 0.3 0.3; opacity: 0.7">
            </a-entity>

        </a-entity>

        <a-sky color="#0a0a0a"></a-sky>
    </a-scene>

    <script>
        // ============================================
        // SISTEMA DE ANIMACI√ìN PROFESIONAL
        // ============================================

        const AnimationSystem = {
            phase: 0,
            audioContext: null,
            source: null,
            filterNode: null,
            gainNode: null,
            isPlaying: false,
            videoStream: null,

            // Inicializar
            async init() {
                console.log('üé¨ Iniciando sistema de animaci√≥n');
                
                // Iniciar c√°mara
                await this.startCamera();
                
                // Event listeners
                document.getElementById('btnStartAnimation').addEventListener('click', () => {
                    this.startSequence();
                });
                
                document.getElementById('btnResetCamera').addEventListener('click', () => {
                    this.resetCamera();
                });
            },

            async startCamera() {
                try {
                    this.videoStream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            facingMode: 'environment',
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        }
                    });
                    
                    const video = document.getElementById('cameraVideo');
                    video.srcObject = this.videoStream;
                    video.style.display = 'block';
                    await video.play();
                    
                    console.log('‚úÖ C√°mara iniciada');
                } catch (error) {
                    console.log('‚ö†Ô∏è Sin c√°mara, modo desktop');
                }
            },

            resetCamera() {
                const camera = document.getElementById('mainCamera');
                camera.setAttribute('position', '0 1.6 5');
                camera.setAttribute('rotation', '0 0 0');
            },

            updateHUD(db, status) {
                const dbValue = document.getElementById('hudDbValue');
                const statusEl = document.getElementById('hudStatus');
                const fill = document.getElementById('hudFill');
                
                dbValue.textContent = `${db} dB`;
                statusEl.textContent = status;
                
                const percentage = Math.min(100, (db / 120) * 100);
                fill.style.width = `${percentage}%`;
                
                if (db < 60) {
                    dbValue.classList.add('safe');
                    fill.style.background = 'linear-gradient(90deg, #34c759, #30d158)';
                } else {
                    dbValue.classList.remove('safe');
                    fill.style.background = 'linear-gradient(90deg, #D71920, #ff6b6b)';
                }
            },

            async loadAudio() {
                try {
                    const AC = window.AudioContext || window.webkitAudioContext;
                    this.audioContext = new AC();
                    
                    const response = await fetch('Sonidos_De_Fabrica.wav');
                    if (!response.ok) throw new Error('No audio');
                    
                    const arrayBuffer = await response.arrayBuffer();
                    const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);
                    
                    this.source = this.audioContext.createBufferSource();
                    this.source.buffer = audioBuffer;
                    this.source.loop = true;
                    
                    this.filterNode = this.audioContext.createBiquadFilter();
                    this.filterNode.type = 'lowpass';
                    this.filterNode.frequency.value = 22000;
                    
                    this.gainNode = this.audioContext.createGain();
                    this.gainNode.gain.value = 1.0;
                    
                    this.source.connect(this.filterNode);
                    this.filterNode.connect(this.gainNode);
                    this.gainNode.connect(this.audioContext.destination);
                    
                    this.source.start(0);
                    return true;
                } catch (error) {
                    console.log('üîá Modo silencioso');
                    return false;
                }
            },

            // ============================================
            // SECUENCIA DE ANIMACI√ìN
            // ============================================

            async startSequence() {
                if (this.isPlaying) return;
                this.isPlaying = true;
                
                const btn = document.getElementById('btnStartAnimation');
                btn.innerHTML = '<span class="loading-spinner"></span> CARGANDO...';
                btn.disabled = true;
                
                await this.loadAudio();
                
                btn.style.display = 'none';
                document.getElementById('btnResetCamera').style.display = 'block';
                
                this.phase1_Suffering();
            },

            // FASE 1: Sufrimiento por ruido
            phase1_Suffering() {
                console.log('üìç FASE 1: Sufrimiento');
                this.phase = 1;
                
                document.getElementById('statusText').textContent = 
                    '‚ö†Ô∏è Exposici√≥n a ruido industrial peligroso';
                
                this.updateHUD(105, 'PELIGRO');
                
                // Efectos visuales
                document.getElementById('soundWaves').setAttribute('visible', 'true');
                document.getElementById('stressParticles').setAttribute('visible', 'true');
                document.getElementById('infoText').setAttribute('visible', 'true');
                document.getElementById('dangerOverlay').classList.add('active');
                
                // Luz roja pulsante
                const light = document.getElementById('dangerLight');
                light.setAttribute('animation', {
                    property: 'light.intensity',
                    from: 0,
                    to: 3,
                    dir: 'alternate',
                    dur: 800,
                    loop: true
                });
                
                // Vibraci√≥n del stickman
                const stickman = document.getElementById('stickman');
                stickman.setAttribute('animation__shake', {
                    property: 'rotation',
                    from: '0 0 -3',
                    to: '0 0 3',
                    dir: 'alternate',
                    dur: 100,
                    loop: true
                });
                
                // Boca en expresi√≥n de dolor
                const mouth = document.getElementById('mouth').children[0];
                mouth.setAttribute('rotation', '180 0 0'); // Boca hacia abajo
                
                setTimeout(() => this.phase2_CoveringEars(), 3000);
            },

            // FASE 2: Cubrirse los o√≠dos
            phase2_CoveringEars() {
                console.log('üìç FASE 2: Cubriendo o√≠dos');
                this.phase = 2;
                
                document.getElementById('statusText').textContent = 
                    'Protecci√≥n insuficiente con las manos';
                
                // Animar brazos hacia la cabeza
                const leftShoulder = document.getElementById('leftShoulder');
                const leftUpperArm = document.getElementById('leftUpperArm');
                const leftForearm = document.getElementById('leftForearm');
                
                const rightShoulder = document.getElementById('rightShoulder');
                const rightUpperArm = document.getElementById('rightUpperArm');
                const rightForearm = document.getElementById('rightForearm');
                
                // Brazo izquierdo sube
                leftShoulder.setAttribute('animation__raise', {
                    property: 'rotation',
                    to: '0 0 90',
                    dur: 800,
                    easing: 'easeInOutQuad'
                });
                
                leftUpperArm.setAttribute('animation__bend', {
                    property: 'rotation',
                    to: '0 0 -100',
                    dur: 800,
                    easing: 'easeInOutQuad'
                });
                
                // Brazo derecho sube
                rightShoulder.setAttribute('animation__raise', {
                    property: 'rotation',
                    to: '0 0 -90',
                    dur: 800,
                    easing: 'easeInOutQuad'
                });
                
                rightUpperArm.setAttribute('animation__bend', {
                    property: 'rotation',
                    to: '0 0 100',
                    dur: 800,
                    easing: 'easeInOutQuad'
                });
                
                this.updateHUD(95, 'TODAV√çA PELIGROSO');
                
                setTimeout(() => this.phase3_Walking(), 4000);
            },

            // FASE 3: Caminar hacia la mesa
            phase3_Walking() {
                console.log('üìç FASE 3: Caminando');
                this.phase = 3;
                
                document.getElementById('statusText').textContent = 
                    'Buscando protecci√≥n auditiva adecuada...';
                
                // Bajar brazos
                const leftShoulder = document.getElementById('leftShoulder');
                const rightShoulder = document.getElementById('rightShoulder');
                const leftUpperArm = document.getElementById('leftUpperArm');
                const rightUpperArm = document.getElementById('rightUpperArm');
                
                leftShoulder.setAttribute('animation__lower', {
                    property: 'rotation',
                    to: '0 0 20',
                    dur: 500
                });
                
                leftUpperArm.setAttribute('animation__unbend', {
                    property: 'rotation',
                    to: '0 0 0',
                    dur: 500
                });
                
                rightShoulder.setAttribute('animation__lower', {
                    property: 'rotation',
                    to: '0 0 -20',
                    dur: 500
                });
                
                rightUpperArm.setAttribute('animation__unbend', {
                    property: 'rotation',
                    to: '0 0 0',
                    dur: 500
                });
                
                // Rotar hacia la mesa
                const stickman = document.getElementById('stickman');
                stickman.removeAttribute('animation__shake');
                
                stickman.setAttribute('animation__turn', {
                    property: 'rotation',
                    to: '0 -45 0',
                    dur: 1000,
                    easing: 'easeInOutQuad'
                });
                
                // Caminar hacia la mesa
                setTimeout(() => {
                    // Animaci√≥n de caminar (piernas)
                    const leftHip = document.getElementById('leftHip');
                    const rightHip = document.getElementById('rightHip');
                    
                    leftHip.setAttribute('animation__walk', {
                        property: 'rotation',
                        from: '0 0 5',
                        to: '30 0 5',
                        dir: 'alternate',
                        dur: 400,
                        loop: 6,
                        easing: 'easeInOutSine'
                    });
                    
                    rightHip.setAttribute('animation__walk', {
                        property: 'rotation',
                        from: '0 0 -5',
                        to: '-30 0 -5',
                        dir: 'alternate',
                        dur: 400,
                        loop: 6,
                        easing: 'easeInOutSine'
                    });
                    
                    // Mover hacia la mesa
                    stickman.setAttribute('animation__move', {
                        property: 'position',
                        to: '1.8 0 0',
                        dur: 2400,
                        easing: 'linear'
                    });
                    
                    // Braceo al caminar
                    leftShoulder.setAttribute('animation__swing', {
                        property: 'rotation',
                        from: '0 0 20',
                        to: '30 0 20',
                        dir: 'alternate',
                        dur: 400,
                        loop: 6
                    });
                    
                    rightShoulder.setAttribute('animation__swing', {
                        property: 'rotation',
                        from: '0 0 -20',
                        to: '-30 0 -20',
                        dir: 'alternate',
                        dur: 400,
                        loop: 6
                    });
                    
                }, 1000);
                
                setTimeout(() => this.phase4_TakingHeadphones(), 4500);
            },

            // FASE 4: Tomar auriculares
            phase4_TakingHeadphones() {
                console.log('üìç FASE 4: Tomando auriculares');
                this.phase = 4;
                
                document.getElementById('statusText').textContent = 
                    'Coloc√°ndose protecci√≥n auditiva certificada';
                
                // Detener animaci√≥n de caminar
                const stickman = document.getElementById('stickman');
                const leftHip = document.getElementById('leftHip');
                const rightHip = document.getElementById('rightHip');
                
                leftHip.removeAttribute('animation__walk');
                rightHip.removeAttribute('animation__walk');
                leftHip.setAttribute('rotation', '0 0 5');
                rightHip.setAttribute('rotation', '0 0 -5');
                
                // Brazo hacia auriculares
                const rightShoulder = document.getElementById('rightShoulder');
                const rightUpperArm = document.getElementById('rightUpperArm');
                const rightForearm = document.getElementById('rightForearm');
                
                rightShoulder.removeAttribute('animation__swing');
                rightShoulder.setAttribute('animation__reach', {
                    property: 'rotation',
                    to: '0 0 -80',
                    dur: 1000
                });
                
                rightUpperArm.setAttribute('animation__extend', {
                    property: 'rotation',
                    to: '0 0 40',
                    dur: 1000
                });
                
                rightForearm.setAttribute('animation__grab', {
                    property: 'rotation',
                    to: '0 0 -30',
                    dur: 1000,
                    delay: 500
                });
                
                // Auriculares hacia el stickman
                setTimeout(() => {
                    const headphones = document.getElementById('headphones');
                    headphones.removeAttribute('animation');
                    
                    headphones.setAttribute('animation__approach', {
                        property: 'position',
                        to: '1.8 1.5 0',
                        dur: 1500,
                        easing: 'easeInOutCubic'
                    });
                    
                    headphones.setAttribute('animation__scale', {
                        property: 'scale',
                        to: '0.8 0.8 0.8',
                        dur: 1500,
                        easing: 'easeInOutCubic'
                    });
                }, 1200);
                
                setTimeout(() => this.phase5_WearingHeadphones(), 3000);
            },

            // FASE 5: Auriculares puestos
            phase5_WearingHeadphones() {
                console.log('üìç FASE 5: Protecci√≥n aplicada');
                this.phase = 5;
                
                document.getElementById('statusText').textContent = 
                    '‚úÖ Protecci√≥n auditiva efectiva aplicada';
                
                // Ocultar auriculares (ahora est√°n en la cabeza)
                const headphones = document.getElementById('headphones');
                headphones.setAttribute('visible', 'false');
                
                // Bajar brazos
                const leftShoulder = document.getElementById('leftShoulder');
                const rightShoulder = document.getElementById('rightShoulder');
                const rightUpperArm = document.getElementById('rightUpperArm');
                const rightForearm = document.getElementById('rightForearm');
                
                leftShoulder.removeAttribute('animation__swing');
                leftShoulder.setAttribute('animation__down', {
                    property: 'rotation',
                    to: '0 0 20',
                    dur: 800
                });
                
                rightShoulder.setAttribute('animation__down', {
                    property: 'rotation',
                    to: '0 0 -20',
                    dur: 800
                });
                
                rightUpperArm.setAttribute('animation__down', {
                    property: 'rotation',
                    to: '0 0 0',
                    dur: 800
                });
                
                rightForearm.setAttribute('animation__down', {
                    property: 'rotation',
                    to: '0 0 0',
                    dur: 800
                });
                
                // Atenuar audio
                if (this.audioContext && this.filterNode && this.gainNode) {
                    const t = this.audioContext.currentTime;
                    this.filterNode.frequency.exponentialRampToValueAtTime(250, t + 2);
                    this.gainNode.gain.exponentialRampToValueAtTime(0.05, t + 2);
                }
                
                // Detener efectos de peligro
                document.getElementById('soundWaves').setAttribute('visible', 'false');
                document.getElementById('stressParticles').setAttribute('visible', 'false');
                document.getElementById('dangerOverlay').classList.remove('active');
                
                const light = document.getElementById('dangerLight');
                light.removeAttribute('animation');
                light.setAttribute('light', 'intensity', 0);
                
                // Cambiar boca a sonrisa
                const mouth = document.getElementById('mouth').children[0];
                mouth.setAttribute('rotation', '0 0 0');
                
                // Actualizar texto
                document.getElementById('infoTextContent').setAttribute('value', '‚úÖ 60 dB - SEGURO ‚úÖ');
                document.getElementById('infoTextContent').setAttribute('color', '#00FF00');
                document.getElementById('infoTextSub').setAttribute('value', 'Protecci√≥n efectiva aplicada');
                
                this.updateHUD(60, 'SEGURO');
                
                setTimeout(() => this.phase6_Final(), 3000);
            },

            // FASE 6: Mensaje final
            phase6_Final() {
                console.log('üìç FASE 6: Mensaje final');
                this.phase = 6;
                
                document.getElementById('infoText').setAttribute('visible', 'false');
                
                // Mostrar mensaje educativo completo
                const infoText = document.getElementById('infoText');
                infoText.setAttribute('visible', 'true');
                
                const plane1 = infoText.children[0];
                const plane2 = infoText.children[1];
                const plane3 = infoText.children[2];
                
                plane1.setAttribute('width', '4');
                plane1.setAttribute('height', '2');
                plane2.setAttribute('width', '3.9');
                plane2.setAttribute('height', '1.9');
                plane3.setAttribute('width', '3.8');
                plane3.setAttribute('height', '1.8');
                
                document.getElementById('infoTextContent').setAttribute('value', 'üõ°Ô∏è PROTECCI√ìN AUDITIVA üõ°Ô∏è');
                document.getElementById('infoTextContent').setAttribute('color', '#00FF00');
                document.getElementById('infoTextContent').setAttribute('position', '0 0.7 0.05');
                document.getElementById('infoTextContent').setAttribute('width', '4.5');
                
                document.getElementById('infoTextSub').setAttribute('value', 
                    'Usa protecci√≥n en ambientes >85dB\n' +
                    'Incluye f√°bricas, construcci√≥n,\n' +
                    'conciertos y herramientas el√©ctricas.\n\n' +
                    'TU AUDICI√ìN NO SE REGENERA');
                document.getElementById('infoTextSub').setAttribute('position', '0 -0.3 0.05');
                document.getElementById('infoTextSub').setAttribute('width', '4');
                
                document.getElementById('statusText').textContent = 
                    '‚úÖ Simulaci√≥n completada - Tu audici√≥n es valiosa';
            }
        };

        // TWEEN animation loop
        function animate(time) {
            requestAnimationFrame(animate);
            TWEEN.update(time);
        }
        requestAnimationFrame(animate);

        // Init
        window.addEventListener('load', () => {
            console.log('üöÄ LANXESS AR - Animaci√≥n Educativa Cargada');
            AnimationSystem.init();
        });
    </script>
</body>
</html>
