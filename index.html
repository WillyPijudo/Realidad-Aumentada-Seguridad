<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Lanxess Safety AR</title>

    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        /* --- FUENTES Y VARIABLES --- */
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700;900&family=Roboto:wght@300;400;900&display=swap');

        :root {
            /* Paleta Corporativa Lanxess/Industrial */
            --corp-red: #D71920;      /* Rojo Intenso */
            --corp-black: #0F0F0F;    /* Negro Profundo */
            --corp-dark: #1A1A1A;     /* Gris Oscuro */
            --corp-white: #FFFFFF;    /* Blanco Puro */
            --corp-gray: #B0B0B0;     /* Gris Plata */
            
            /* Estados */
            --state-danger: #ff3b30;
            --state-safe: #34c759;
            --state-warning: #ffcc00;

            /* Tipograf√≠a */
            --font-head: 'Exo 2', sans-serif;
            --font-body: 'Roboto', sans-serif;
        }

        /* --- RESET GLOBAL --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body {
            margin: 0; padding: 0;
            width: 100vw; height: 100dvh;
            background-color: var(--corp-black);
            font-family: var(--font-body);
            overflow: hidden;
            color: var(--corp-white);
        }

        /* --- SISTEMA DE VISTAS (SPA) --- */
        .view-section {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            display: none; /* Oculto por defecto */
            opacity: 0; transition: opacity 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 10;
            background: var(--corp-black);
        }

        .view-active {
            display: flex; opacity: 1; z-index: 100;
        }

        /* --- BOT√ìN "VOLVER" (GLOBAL Y ROBUSTO) --- */
        .nav-back-btn {
            position: absolute; top: 30px; left: 20px;
            width: 50px; height: 50px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 9999; /* Z-Index Supremo */
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            transition: transform 0.2s;
        }
        .nav-back-btn::after {
            content: '‚Üê'; font-size: 24px; font-weight: bold; color: white;
        }
        .nav-back-btn:active { transform: scale(0.9); background: var(--corp-red); }

        /* =========================================================
           VISTA 1: HOME (MEN√ö PRINCIPAL)
           ========================================================= */
        #view-home {
            flex-direction: column;
            justify-content: center; align-items: center;
            background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
            padding: 30px;
        }

        .brand-header {
            margin-bottom: 60px; text-align: center;
            position: relative;
        }
        
        .brand-header h1 {
            font-family: var(--font-head); font-size: 48px; margin: 0;
            text-transform: uppercase; letter-spacing: 2px;
            background: linear-gradient(to right, #fff, #999);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .brand-line {
            width: 60px; height: 4px; background: var(--corp-red);
            margin: 10px auto; border-radius: 2px;
        }

        .brand-header p {
            color: var(--corp-gray); font-size: 14px; letter-spacing: 1px;
        }

        .menu-options {
            display: grid; gap: 25px; width: 100%; max-width: 450px;
        }

        .menu-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-left: 5px solid var(--corp-red);
            padding: 25px; border-radius: 12px;
            display: flex; align-items: center;
            cursor: pointer; position: relative; overflow: hidden;
            transition: all 0.3s ease;
        }

        .menu-card:active { transform: scale(0.98); background: rgba(255,255,255,0.08); }

        .menu-icon { font-size: 32px; margin-right: 20px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.3)); }
        .menu-info h3 { margin: 0; font-family: var(--font-head); font-size: 20px; color: white; }
        .menu-info p { margin: 5px 0 0; font-size: 12px; color: #888; }
        .arrow-indicator { margin-left: auto; color: var(--corp-red); font-weight: bold; }

        /* =========================================================
           VISTA 2: MEDIDOR REAL (MICR√ìFONO)
           ========================================================= */
        #view-meter {
            background: #000;
            flex-direction: column; align-items: center; justify-content: flex-start;
            padding-top: 100px;
        }

        .meter-ui-circle {
            width: 280px; height: 280px;
            border-radius: 50%;
            border: 4px solid #333;
            position: relative;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            margin-bottom: 40px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        #real-db-val { font-size: 72px; font-weight: 900; font-family: monospace; z-index: 2; }
        #real-db-unit { font-size: 18px; color: #666; margin-top: -10px; z-index: 2; }
        
        .status-badge {
            margin-top: 20px; padding: 8px 16px;
            background: #222; border-radius: 20px;
            font-size: 12px; text-transform: uppercase; letter-spacing: 1px;
            font-weight: bold; color: #fff; transition: background 0.3s;
        }

        canvas#wave-canvas {
            width: 100%; height: 120px;
            position: absolute; bottom: 0; left: 0;
            opacity: 0.5;
        }

        /* =========================================================
           VISTA 3: SIMULADOR AR (HUD T√ÅCTICO)
           ========================================================= */
        #view-ar {
            background: transparent;
            pointer-events: none; /* Crucial para AR */
        }

        /* HUD SUPERIOR */
        .ar-hud-top {
            position: absolute; top: 0; left: 0; width: 100%;
            padding: 20px 20px 0 80px; /* Padding izquierdo para no tapar bot√≥n volver */
            display: flex; justify-content: flex-end;
            pointer-events: none;
        }

        /* Medidor T√°ctico AR */
        .tactical-meter {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-right: 3px solid var(--corp-red);
            padding: 10px 15px;
            border-radius: 4px;
            display: flex; flex-direction: column;
            backdrop-filter: blur(5px);
            min-width: 120px;
        }
        .tm-label { font-size: 10px; color: #aaa; text-transform: uppercase; margin-bottom: 5px; }
        .tm-value { font-size: 28px; font-weight: 900; color: var(--corp-red); font-family: monospace; text-align: right; }
        .tm-bar { width: 100%; height: 4px; background: #333; margin-top: 5px; }
        .tm-fill { height: 100%; width: 0%; background: var(--corp-red); transition: width 0.1s; }

        /* OVERLAY INFERIOR (CONTROLES) */
        .ar-controls {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(0deg, rgba(0,0,0,0.9) 0%, transparent 100%);
            padding: 40px 20px;
            display: flex; flex-direction: column; align-items: center;
            pointer-events: auto; /* Reactivar toques */
        }

        .guide-msg {
            color: #fff; font-size: 16px; margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8); text-align: center;
            opacity: 0.8;
        }

        .btn-premium {
            background: var(--corp-white); color: var(--corp-black);
            border: none; padding: 18px 40px; border-radius: 50px;
            font-size: 16px; font-weight: 900; text-transform: uppercase;
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
            width: 100%; max-width: 320px; cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: none; /* Se activa por JS */
        }
        
        #btn-start-ar { display: block; background: var(--corp-red); color: white; box-shadow: 0 0 20px rgba(215, 25, 32, 0.4); }
        #btn-protect-ar { background: var(--state-safe); color: white; box-shadow: 0 0 20px rgba(52, 199, 89, 0.4); }

        .btn-premium:active { transform: scale(0.96); }

        /* ALERTA ROJA PANTALLA COMPLETA */
        .hazard-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 50;
            animation: pulse-hazard 1s infinite alternate;
            display: none;
        }
        @keyframes pulse-hazard {
            from { box-shadow: inset 0 0 0 transparent; }
            to { box-shadow: inset 0 0 100px rgba(215, 25, 32, 0.6); }
        }

    </style>
</head>
<body>

    <div id="hazard-layer" class="hazard-overlay"></div>

    <div id="view-home" class="view-section view-active">
        <div class="brand-header">
            <h1>Safety Suite</h1>
            <div class="brand-line"></div>
            <p>SISTEMA DE PROTECCI√ìN AUDITIVA</p>
        </div>

        <div class="menu-options">
            <div class="menu-card" onclick="Router.go('meter')">
                <div class="menu-icon">üéôÔ∏è</div>
                <div class="menu-info">
                    <h3>Medidor Ambiental</h3>
                    <p>An√°lisis de dB en tiempo real</p>
                </div>
                <div class="arrow-indicator">‚Üí</div>
            </div>

            <div class="menu-card" onclick="Router.go('ar')">
                <div class="menu-icon">ü•Ω</div>
                <div class="menu-info">
                    <h3>Simulaci√≥n AR</h3>
                    <p>Experiencia inmersiva EPP</p>
                </div>
                <div class="arrow-indicator">‚Üí</div>
            </div>
        </div>
        
        <p style="position: absolute; bottom: 20px; color: #444; font-size: 10px; font-family: monospace;">LANXESS INITIATIVE v8.0</p>
    </div>

    <div id="view-meter" class="view-section">
        <div class="nav-back-btn" onclick="Router.go('home')"></div>

        <div class="meter-ui-circle" id="meter-circle">
            <div id="real-db-val">--</div>
            <div id="real-db-unit">dB SPL</div>
            <div class="status-badge" id="meter-badge">INICIANDO</div>
        </div>

        <div style="padding: 20px; text-align: center; max-width: 300px; color: #aaa; font-size: 14px; line-height: 1.5;">
            El micr√≥fono analizar√° el ruido ambiente. Si el c√≠rculo se torna <span style="color:var(--corp-red)">ROJO</span>, el nivel es perjudicial.
        </div>

        <canvas id="wave-canvas"></canvas>
    </div>

    <div id="view-ar" class="view-section">
        <div class="nav-back-btn" onclick="Router.go('home')"></div>

        <div class="ar-hud-top">
            <div class="tactical-meter">
                <div class="tm-label">SIMULACI√ìN RUIDO</div>
                <div class="tm-value" id="ar-db-val">0 dB</div>
                <div class="tm-bar"><div class="tm-fill" id="ar-db-bar"></div></div>
            </div>
        </div>

        <div class="ar-controls">
            <div class="guide-msg" id="ar-guide-text">Apunta al Marcador de Seguridad</div>
            
            <button id="btn-start-ar" class="btn-premium">üîä INICIAR SIMULACI√ìN</button>
            <button id="btn-protect-ar" class="btn-premium">üéß PONERSE PROTECCI√ìN</button>
        </div>
    </div>

    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; colorManagement: true;"
        style="position: absolute; top: 0; left: 0; z-index: 1;">

        <a-light type="ambient" intensity="0.5"></a-light>
        <a-light type="directional" position="1 2 2" intensity="1.5"></a-light>
        <a-light type="point" color="#D71920" intensity="0.8" position="-1 1 0"></a-light>

        <a-marker type="pattern" url="pattern-marker.patt" smooth="true" smoothCount="5">
            <a-entity id="ar-root" visible="false">
                
                <a-entity id="headphones-3d" position="0 0.5 0">
                    <a-animation attribute="position" to="0 0.6 0" dir="alternate" dur="2000" repeat="indefinite" easing="ease-in-out"></a-animation>
                    
                    <a-torus color="#111" radius="0.55" radius-tubular="0.08" arc="190" rotation="90 0 0" position="0 0.25 0"></a-torus>
                    <a-torus color="#000" radius="0.53" radius-tubular="0.09" arc="150" rotation="90 0 0" position="0 0.24 0"></a-torus>
                    
                    <a-entity position="-0.58 0.25 0">
                        <a-cylinder color="#D71920" height="0.25" radius="0.28" rotation="0 0 90"></a-cylinder>
                        <a-torus color="#222" radius="0.28" radius-tubular="0.09" rotation="0 90 0" position="-0.08 0 0" scale="1 1 0.6"></a-torus>
                        <a-text value="PELIGRO" color="white" rotation="0 -90 0" position="-0.3 0 0" align="center" width="2.5"></a-text>
                    </a-entity>

                    <a-entity position="0.58 0.25 0">
                        <a-cylinder color="#D71920" height="0.25" radius="0.28" rotation="0 0 90"></a-cylinder>
                        <a-torus color="#222" radius="0.28" radius-tubular="0.09" rotation="0 90 0" position="0.08 0 0" scale="1 1 0.6"></a-torus>
                        <a-text value="RUIDO" color="white" rotation="0 90 0" position="0.3 0 0" align="center" width="2.5"></a-text>
                    </a-entity>
                </a-entity>

                <a-entity id="final-panel" visible="false" position="0 0.5 0.5" rotation="-45 0 0" scale="0 0 0">
                    
                    <a-plane color="#000" opacity="0.9" width="4.5" height="3" material="shader: standard; roughness: 0.2; metalness: 0.8"></a-plane>
                    
                    <a-plane color="#D71920" width="4.4" height="2.9" position="0 0 -0.01"></a-plane>

                    <a-text value="RECORDATORIO DE SEGURIDAD" color="#D71920" align="center" width="5" position="0 1.1 0.1" font="exo2bold"></a-text>
                    
                    <a-text id="typewriter-text" value="" color="#FFF" align="center" width="4.2" position="0 0.2 0.1" font="roboto" wrap-count="30" line-height="60"></a-text>

                    <a-text value="HERRAMIENTA DIARIA LANXESS" color="#666" align="center" width="3" position="0 -1.2 0.1" font="roboto"></a-text>
                </a-entity>

            </a-entity>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // CONFIGURACI√ìN GLOBAL
        const Config = {
            audioFile: 'Sonidos_De_Fabrica.wav',
            finalMessage: "No te olvides de usar proteccion auditiva en el hogar o zonas de trabajo.\n\nLos decibelios altos pueden perjudicar tu salud auditiva de forma permanente.\n\nUsa esta herramienta a diario para monitorear tu entorno.",
            typewriterSpeed: 40 // ms por letra
        };

        // --- SISTEMA DE NAVEGACI√ìN (ROUTER) ---
        const Router = {
            current: 'home',
            go: (viewId) => {
                // Ocultar todas las vistas
                document.querySelectorAll('.view-section').forEach(el => {
                    el.classList.remove('view-active');
                    el.style.opacity = '0'; // Fade out
                });

                // Activar la nueva vista con retardo para animaci√≥n
                const target = document.getElementById(`view-${viewId}`);
                target.classList.add('view-active');
                
                // Forzar reflow para la transici√≥n CSS
                setTimeout(() => target.style.opacity = '1', 50);

                // L√≥gica Espec√≠fica
                if (viewId === 'home') {
                    RealMeter.stop();
                    ARSystem.pause();
                } else if (viewId === 'meter') {
                    RealMeter.start();
                    ARSystem.pause();
                } else if (viewId === 'ar') {
                    RealMeter.stop();
                    ARSystem.resume();
                }
            }
        };

        // --- SISTEMA DE TEXTO TYPEWRITER (A-FRAME COMPONENT) ---
        // Este sistema inyecta el texto letra por letra en el panel 3D
        const TypewriterSys = {
            targetEntity: null,
            timer: null,
            
            start: (text) => {
                const entity = document.getElementById('typewriter-text');
                let i = 0;
                entity.setAttribute('value', ''); // Limpiar
                
                if(TypewriterSys.timer) clearInterval(TypewriterSys.timer);

                TypewriterSys.timer = setInterval(() => {
                    if (i < text.length) {
                        // A√±adir letra
                        const currentVal = entity.getAttribute('value');
                        entity.setAttribute('value', currentVal + text.charAt(i));
                        i++;
                    } else {
                        clearInterval(TypewriterSys.timer);
                    }
                }, Config.typewriterSpeed);
            }
        };

        // --- SISTEMA AR (SIMULADOR) ---
        const ARSystem = {
            audioCtx: null, source: null, gain: null, filter: null,
            isProtected: false, isLoaded: false, interval: null,

            init: () => {
                document.getElementById('btn-start-ar').addEventListener('click', ARSystem.start);
                document.getElementById('btn-protect-ar').addEventListener('click', ARSystem.protect);
                
                // Detecci√≥n de marcador
                document.querySelector('a-marker').addEventListener('markerFound', () => {
                    document.getElementById('ar-root').setAttribute('visible', true);
                    document.getElementById('ar-guide-text').style.display = 'none';
                    if(!ARSystem.isLoaded) document.getElementById('btn-start-ar').style.display = 'block';
                });
            },

            start: async () => {
                const btn = document.getElementById('btn-start-ar');
                btn.innerText = "CARGANDO AUDIO...";
                
                try {
                    const AC = window.AudioContext || window.webkitAudioContext;
                    ARSystem.audioCtx = new AC();
                    
                    const resp = await fetch(Config.audioFile);
                    if(!resp.ok) throw new Error("Audio missing");
                    const buf = await resp.arrayBuffer();
                    const decoded = await ARSystem.audioCtx.decodeAudioData(buf);

                    ARSystem.source = ARSystem.audioCtx.createBufferSource();
                    ARSystem.source.buffer = decoded;
                    ARSystem.source.loop = true;

                    ARSystem.filter = ARSystem.audioCtx.createBiquadFilter();
                    ARSystem.filter.type = 'lowpass';
                    ARSystem.filter.frequency.value = 22000;

                    ARSystem.gain = ARSystem.audioCtx.createGain();
                    ARSystem.gain.value = 1.0;

                    ARSystem.source.connect(ARSystem.filter).connect(ARSystem.gain).connect(ARSystem.audioCtx.destination);
                    ARSystem.source.start(0);

                    // UI Updates
                    ARSystem.isLoaded = true;
                    btn.style.display = 'none';
                    document.getElementById('btn-protect-ar').style.display = 'block';
                    document.getElementById('hazard-layer').style.display = 'block'; // Alerta roja
                    
                    ARSystem.loopHUD();

                } catch (e) {
                    alert("Error: No se encontr√≥ el audio. Verifica GitHub.");
                    btn.innerText = "ERROR";
                }
            },

            protect: () => {
                if(ARSystem.isProtected) return;
                ARSystem.isProtected = true;

                // 1. Audio Effect
                const t = ARSystem.audioCtx.currentTime;
                ARSystem.filter.frequency.exponentialRampToValueAtTime(300, t + 1.5);
                ARSystem.gain.gain.exponentialRampToValueAtTime(0.2, t + 1.5);

                // 2. Visuals
                document.getElementById('btn-protect-ar').style.display = 'none';
                document.getElementById('hazard-layer').style.display = 'none';
                document.getElementById('ar-db-val').style.color = "#34c759";
                document.getElementById('ar-db-bar').style.background = "#34c759";

                // 3. ANIMACI√ìN DE "VUELO" DE AURICULARES
                const hp = document.getElementById('headphones-3d');
                
                // Tween Posici√≥n (Acercarse a c√°mara)
                new TWEEN.Tween({z: 0, s: 1})
                    .to({z: 2, s: 6}, 1000)
                    .easing(TWEEN.Easing.Quadratic.In)
                    .onUpdate((obj) => {
                        hp.setAttribute('position', `0 0.5 ${obj.z}`);
                        hp.setAttribute('scale', `${obj.s} ${obj.s} ${obj.s}`);
                    })
                    .onComplete(() => {
                        hp.setAttribute('visible', false);
                        
                        // MOSTRAR PANEL FINAL
                        const panel = document.getElementById('final-panel');
                        panel.setAttribute('visible', true);
                        
                        // Animar escala del panel (Pop up)
                        new TWEEN.Tween({s: 0}).to({s: 1}, 800)
                            .easing(TWEEN.Easing.Elastic.Out)
                            .onUpdate((o) => panel.setAttribute('scale', `${o.s} ${o.s} ${o.s}`))
                            .start();
                        
                        // Iniciar efecto m√°quina de escribir
                        TypewriterSys.start(Config.finalMessage);
                    })
                    .start();
            },

            loopHUD: () => {
                ARSystem.interval = setInterval(() => {
                    if(!ARSystem.isLoaded) return;
                    let db = 0;
                    if (!ARSystem.isProtected) db = Math.floor(Math.random()*(105-95)+95);
                    else db = Math.floor(Math.random()*(75-65)+65);
                    
                    document.getElementById('ar-db-val').innerText = db + " dB";
                    document.getElementById('ar-db-bar').style.width = (db/110)*100 + "%";
                }, 100);
            },

            pause: () => {
                document.querySelector('a-scene').style.visibility = 'hidden';
                if(ARSystem.audioCtx) ARSystem.audioCtx.suspend();
            },
            resume: () => {
                document.querySelector('a-scene').style.visibility = 'visible';
                if(ARSystem.audioCtx) ARSystem.audioCtx.resume();
            }
        };

        // --- SISTEMA MEDIDOR REAL ---
        const RealMeter = {
            active: false, stream: null, ctx: null, analyser: null,
            start: async () => {
                if(RealMeter.active) return;
                try {
                    RealMeter.stream = await navigator.mediaDevices.getUserMedia({audio: true});
                    RealMeter.ctx = new (window.AudioContext||window.webkitAudioContext)();
                    RealMeter.analyser = RealMeter.ctx.createAnalyser();
                    const src = RealMeter.ctx.createMediaStreamSource(RealMeter.stream);
                    src.connect(RealMeter.analyser);
                    RealMeter.active = true;
                    RealMeter.draw();
                } catch(e) {
                    alert("Permiso de micr√≥fono denegado.");
                    Router.go('home');
                }
            },
            stop: () => {
                if(!RealMeter.active) return;
                RealMeter.stream.getTracks().forEach(t=>t.stop());
                RealMeter.ctx.close();
                RealMeter.active = false;
            },
            draw: () => {
                if(!RealMeter.active) return;
                requestAnimationFrame(RealMeter.draw);
                
                const buffer = new Uint8Array(RealMeter.analyser.frequencyBinCount);
                RealMeter.analyser.getByteFrequencyData(buffer);
                
                // Promedio
                const avg = buffer.reduce((a,b)=>a+b) / buffer.length;
                let db = Math.floor(avg * 1.5); 
                if(db>110) db=110; if(db<30) db=30;

                // UI
                const circle = document.getElementById('meter-circle');
                const badge = document.getElementById('meter-badge');
                document.getElementById('real-db-val').innerText = db;

                if(db < 60) {
                    circle.style.borderColor = "#34c759"; badge.style.background="#34c759"; badge.innerText="SEGURO";
                } else if(db < 85) {
                    circle.style.borderColor = "#ffcc00"; badge.style.background="#ffcc00"; badge.innerText="ALERTA";
                } else {
                    circle.style.borderColor = "#ff3b30"; badge.style.background="#ff3b30"; badge.innerText="PELIGRO";
                }

                // Canvas Ondas
                const cvs = document.getElementById('wave-canvas');
                const c = cvs.getContext('2d');
                c.clearRect(0,0,300,150);
                c.fillStyle = `rgba(255,255,255,0.2)`;
                const w = 300/buffer.length * 2.5;
                let x = 0;
                for(let i=0; i<buffer.length; i++) {
                    c.fillRect(x, 150 - buffer[i]/2, w, buffer[i]/2);
                    x += w + 1;
                }
            }
        };

        // Bucle de Animaci√≥n Global (TWEEN)
        function animate(time) {
            requestAnimationFrame(animate);
            TWEEN.update(time);
        }
        requestAnimationFrame(animate);

        // INICIO
        window.addEventListener('load', () => {
            ARSystem.init();
            console.log("System v8.0 Online");
        });

    </script>
</body>
</html>
