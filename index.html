<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#D71920">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Lanxess Safety AR Pro v18.0</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Exo+2:wght@400;700&family=Roboto:wght@400;700&display=swap');
        :root {
            --primary-red: #D71920;
            --deep-black: #0a0a0a;
            --dark-gray: #1a1a1a;
            --light-gray: #b0b0b0;
            --pure-white: #ffffff;
            --danger: #ff3b30;
            --safe: #34c759;
            --font-display: 'Orbitron', monospace;
            --font-heading: 'Exo 2', sans-serif;
            --font-body: 'Roboto', sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        html, body { width: 100%; height: 100%; position: fixed; overflow: hidden; }
        body { background: var(--deep-black); font-family: var(--font-body); color: var(--pure-white); }
        
        #cameraVideo { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0; display: none; }
        
        .view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; opacity: 0; transition: opacity 0.6s; z-index: 1; }
        .view.active { display: flex; opacity: 1; z-index: 10; }
        
        .btn-back { position: fixed; top: 30px; left: 15px; width: 50px; height: 50px; background: rgba(10,10,10,0.95); backdrop-filter: blur(15px); border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 99999; transition: all 0.2s; box-shadow: 0 4px 20px rgba(0,0,0,0.8); pointer-events: auto; }
        .btn-back::before { content: '‚Üê'; font-size: 26px; font-weight: 900; color: var(--pure-white); }
        .btn-back:active { transform: scale(0.88); background: var(--primary-red); border-color: var(--primary-red); }
        
        #home { flex-direction: column; justify-content: center; align-items: center; background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%); padding: 40px 20px; }
        .home-header { text-align: center; margin-bottom: 60px; animation: fadeInDown 1s ease-out; }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        .logo-icon { font-size: 64px; filter: drop-shadow(0 0 25px rgba(215,25,32,0.6)); animation: pulse 2.5s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.08); } }
        .home-header h1 { font-family: var(--font-display); font-size: 38px; font-weight: 900; text-transform: uppercase; letter-spacing: 3px; background: linear-gradient(135deg, var(--pure-white) 0%, var(--light-gray) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 12px; }
        .accent-line { width: 70px; height: 4px; background: var(--primary-red); margin: 12px auto; border-radius: 2px; box-shadow: 0 0 15px rgba(215,25,32,0.7); }
        .home-header p { font-family: var(--font-heading); font-size: 13px; letter-spacing: 2.5px; color: var(--light-gray); text-transform: uppercase; }
        .menu-grid { display: flex; flex-direction: column; gap: 18px; width: 100%; max-width: 380px; animation: fadeInUp 1s ease-out 0.3s both; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .menu-item { background: rgba(255,255,255,0.04); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.12); border-left: 4px solid var(--primary-red); border-radius: 14px; padding: 24px 20px; cursor: pointer; position: relative; overflow: hidden; transition: all 0.4s; display: flex; align-items: center; gap: 18px; }
        .menu-item:active { transform: scale(0.97); background: rgba(255,255,255,0.08); }
        .menu-icon { font-size: 36px; min-width: 36px; }
        .menu-content h3 { font-family: var(--font-heading); font-size: 20px; font-weight: 700; margin-bottom: 5px; }
        .menu-content p { font-size: 12px; color: var(--light-gray); line-height: 1.4; }
        .menu-arrow { margin-left: auto; font-size: 22px; color: var(--primary-red); font-weight: 900; }
        .home-footer { position: absolute; bottom: 30px; text-align: center; font-family: var(--font-display); font-size: 9px; color: #444; letter-spacing: 2px; width: 100%; }
        
        #meter { flex-direction: column; align-items: center; justify-content: flex-start; background: linear-gradient(180deg, #000000 0%, #1a1a1a 100%); padding-top: 120px; }
        .meter-display { width: 280px; height: 280px; position: relative; margin-bottom: 40px; }
        .meter-circle { width: 100%; height: 100%; border-radius: 50%; background: radial-gradient(circle, rgba(26,26,26,0.9) 0%, rgba(10,10,10,1) 100%); border: 5px solid #2a2a2a; box-shadow: 0 0 50px rgba(0,0,0,0.9), inset 0 0 50px rgba(0,0,0,0.6); display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; transition: all 0.4s; }
        .meter-circle::before { content: ''; position: absolute; top: -8px; left: -8px; right: -8px; bottom: -8px; border-radius: 50%; background: conic-gradient(from 0deg, transparent 0%, var(--primary-red) 50%, transparent 100%); opacity: 0; transition: opacity 0.4s; z-index: -1; animation: rotate 3s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .meter-circle.danger::before { opacity: 0.7; }
        .db-value { font-family: var(--font-display); font-size: 76px; font-weight: 900; color: var(--pure-white); text-shadow: 0 0 25px rgba(255,255,255,0.6); line-height: 1; margin-bottom: 5px; }
        .db-unit { font-family: var(--font-heading); font-size: 16px; color: var(--light-gray); letter-spacing: 2px; }
        .status-indicator { margin-top: 20px; padding: 9px 20px; background: rgba(255,255,255,0.06); border-radius: 25px; border: 1px solid rgba(255,255,255,0.12); font-family: var(--font-heading); font-size: 12px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; transition: all 0.2s; }
        .wave-visualizer { width: 90%; max-width: 360px; height: 100px; position: relative; margin-top: 30px; background: rgba(255,255,255,0.02); border-radius: 10px; border: 1px solid rgba(255,255,255,0.06); overflow: hidden; }
        #waveCanvas { width: 100%; height: 100%; }
        .meter-info { max-width: 320px; padding: 20px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; margin-top: 25px; text-align: center; }
        .meter-info p { font-size: 13px; line-height: 1.6; color: var(--light-gray); }
        .meter-info .highlight { color: var(--primary-red); font-weight: 700; }
        
        #ar { background: transparent !important; pointer-events: none; }
        .ar-hud { position: fixed; top: 90px; right: 15px; pointer-events: none; z-index: 1000; }
        .hud-meter { background: rgba(0,0,0,0.85); backdrop-filter: blur(20px); border: 2px solid rgba(255,255,255,0.25); border-right: 4px solid var(--primary-red); border-radius: 8px; padding: 12px 16px; min-width: 120px; box-shadow: 0 6px 25px rgba(0,0,0,0.7); }
        .hud-label { font-family: var(--font-heading); font-size: 9px; color: var(--light-gray); letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 6px; }
        .hud-value { font-family: var(--font-display); font-size: 28px; font-weight: 900; color: var(--primary-red); text-shadow: 0 0 18px rgba(215,25,32,0.7); line-height: 1; text-align: right; }
        .hud-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.15); border-radius: 2px; margin-top: 8px; overflow: hidden; }
        .hud-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--primary-red) 0%, #ff6b6b 100%); border-radius: 2px; transition: width 0.2s; box-shadow: 0 0 8px rgba(215,25,32,0.9); }
        .ar-controls { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); padding: 25px 20px 40px; display: flex; flex-direction: column; align-items: center; gap: 12px; pointer-events: auto; z-index: 1000; }
        .ar-status-text { font-family: var(--font-heading); font-size: 16px; font-weight: 600; color: var(--pure-white); text-align: center; margin-bottom: 8px; text-shadow: 0 2px 8px rgba(0,0,0,0.9); min-height: 24px; }
        .btn-ar { width: 100%; max-width: 340px; padding: 18px 28px; background: var(--primary-red); color: var(--pure-white); border: none; border-radius: 50px; font-family: var(--font-heading); font-size: 15px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; box-shadow: 0 6px 25px rgba(215,25,32,0.5); transition: all 0.2s; display: none; }
        .btn-ar.visible { display: block; }
        .btn-ar:active { transform: scale(0.96); }
        .danger-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 800; display: none; animation: dangerPulse 1.5s infinite; }
        .danger-overlay.active { display: block; }
        @keyframes dangerPulse { 0%, 100% { box-shadow: inset 0 0 0 rgba(215,25,32,0); } 50% { box-shadow: inset 0 0 100px rgba(215,25,32,0.5); } }
        .loading-spinner { display: inline-block; width: 16px; height: 16px; border: 3px solid rgba(255,255,255,0.3); border-top-color: var(--pure-white); border-radius: 50%; animation: spin 0.7s linear infinite; margin-right: 8px; vertical-align: middle; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        #arScene { position: fixed !important; top: 0 !important; left: 0 !important; width: 100% !important; height: 100% !important; z-index: 5 !important; }
        .a-enter-vr, .a-orientation-modal { display: none !important; }
    </style>
</head>
<body>
    <video id="cameraVideo" playsinline autoplay muted></video>
    <div id="dangerOverlay" class="danger-overlay"></div>

    <div id="home" class="view active">
        <div class="home-header">
            <div class="logo-icon">üéß</div>
            <h1>Safety Suite</h1>
            <div class="accent-line"></div>
            <p>Protecci√≥n Auditiva</p>
        </div>
        <div class="menu-grid">
            <div class="menu-item" data-nav="meter">
                <div class="menu-icon">üéôÔ∏è</div>
                <div class="menu-content"><h3>Medidor Ambiental</h3><p>An√°lisis de decibelios en tiempo real</p></div>
                <div class="menu-arrow">‚Üí</div>
            </div>
            <div class="menu-item" data-nav="ar">
                <div class="menu-icon">ü•Ω</div>
                <div class="menu-content"><h3>Simulaci√≥n AR</h3><p>Experiencia inmersiva de protecci√≥n</p></div>
                <div class="menu-arrow">‚Üí</div>
            </div>
        </div>
        <div class="home-footer">LANXESS AR ‚Ä¢ v18.0 PRO</div>
    </div>

    <div id="meter" class="view">
        <div class="btn-back" data-nav="home"></div>
        <div class="meter-display">
            <div class="meter-circle" id="meterCircle">
                <div class="db-value" id="dbValue">--</div>
                <div class="db-unit">dB SPL</div>
                <div class="status-indicator" id="statusIndicator">INICIANDO</div>
            </div>
        </div>
        <div class="wave-visualizer"><canvas id="waveCanvas"></canvas></div>
        <div class="meter-info"><p>El micr√≥fono analiza el ruido ambiente en tiempo real. Cuando el medidor se torna <span class="highlight">ROJO</span>, el nivel de decibelios es perjudicial para tu audici√≥n.</p></div>
    </div>

    <div id="ar" class="view">
        <div class="btn-back" data-nav="home"></div>
        <div class="ar-hud">
            <div class="hud-meter">
                <div class="hud-label">NIVEL RUIDO</div>
                <div class="hud-value" id="hudValue">0 dB</div>
                <div class="hud-bar"><div class="hud-fill" id="hudFill"></div></div>
            </div>
        </div>
        <div class="ar-controls">
            <div class="ar-status-text" id="arStatusText">Apunta la c√°mara al suelo para ver la escena 3D</div>
            <button id="btnStartAR" class="btn-ar visible">üé¨ INICIAR ANIMACI√ìN</button>
            <button id="btnNextPhase" class="btn-ar">‚ñ∂ CONTINUAR</button>
        </div>
    </div>

    <a-scene id="arScene" vr-mode-ui="enabled: false" renderer="antialias: true; alpha: true; colorManagement: true; physicallyCorrectLights: true" loading-screen="enabled: false" embedded background="transparent" device-orientation-permission-ui="enabled: false" style="display: none;">
        
        <a-camera id="mainCamera" position="0 1.6 0" look-controls="enabled: true; touchEnabled: true; mouseEnabled: false; magicWindowTrackingEnabled: true; pointerLockEnabled: false" wasd-controls="enabled: false"></a-camera>

        <a-entity light="type: ambient; color: #FFF; intensity: 0.9"></a-entity>
        <a-entity light="type: directional; color: #FFF; intensity: 2; castShadow: true" position="5 12 4"></a-entity>
        <a-entity light="type: directional; color: #FFF; intensity: 1.5; castShadow: true" position="-5 10 -4"></a-entity>
        <a-entity light="type: point; color: #FFF; intensity: 2; distance: 20; castShadow: true" position="0 5 0"></a-entity>
        <a-entity id="dangerLight" light="type: point; color: #D71920; intensity: 0; distance: 25; castShadow: true" position="0 4 -3"></a-entity>

        <a-plane id="ground" position="0 0 -3" rotation="-90 0 0" width="20" height="20" color="#1a1a1a" shadow="receive: true" material="roughness: 0.9; metalness: 0.1"></a-plane>

        <a-entity id="mainScene" position="0 0 -3">

            <!-- MESA PROFESIONAL -->
            <a-entity id="tableGroup" position="2.2 0 0.4" shadow="cast: true; receive: true">
                <a-box id="tableTop" width="1.4" height="0.07" depth="0.85" position="0 0.8 0" color="#8B4513" shadow="cast: true" material="roughness: 0.6; metalness: 0.1"></a-box>
                <a-box width="1.43" height="0.05" depth="0.88" position="0 0.835 0" color="#654321" shadow="cast: true"></a-box>
                
                <a-entity position="-0.6 0.4 -0.35"><a-cylinder radius="0.035" height="0.8" color="#654321" shadow="cast: true"></a-cylinder><a-cylinder radius="0.04" height="0.05" color="#4a2f1a" position="0 0.425 0"></a-cylinder></a-entity>
                <a-entity position="0.6 0.4 -0.35"><a-cylinder radius="0.035" height="0.8" color="#654321" shadow="cast: true"></a-cylinder><a-cylinder radius="0.04" height="0.05" color="#4a2f1a" position="0 0.425 0"></a-cylinder></a-entity>
                <a-entity position="-0.6 0.4 0.35"><a-cylinder radius="0.035" height="0.8" color="#654321" shadow="cast: true"></a-cylinder><a-cylinder radius="0.04" height="0.05" color="#4a2f1a" position="0 0.425 0"></a-cylinder></a-entity>
                <a-entity position="0.6 0.4 0.35"><a-cylinder radius="0.035" height="0.8" color="#654321" shadow="cast: true"></a-cylinder><a-cylinder radius="0.04" height="0.05" color="#4a2f1a" position="0 0.425 0"></a-cylinder></a-entity>
                
                <a-box width="1.25" height="0.025" depth="0.025" color="#654321" position="0 0.2 -0.35" shadow="cast: true"></a-box>
                <a-box width="1.25" height="0.025" depth="0.025" color="#654321" position="0 0.2 0.35" shadow="cast: true"></a-box>
                <a-box width="0.025" height="0.025" depth="0.75" color="#654321" position="-0.6 0.2 0" shadow="cast: true"></a-box>
                <a-box width="0.025" height="0.025" depth="0.75" color="#654321" position="0.6 0.2 0" shadow="cast: true"></a-box>
            </a-entity>

            <!-- AURICULARES ULTRA DETALLADOS -->
            <a-entity id="headphonesGroup" position="2.2 0.92 0.4" scale="1 1 1" shadow="cast: true; receive: true">
                <a-entity id="headband" position="0 0 0">
                    <a-torus radius="0.15" radius-tubular="0.015" color="#2a2a2a" rotation="0 0 0" arc="180" material="metalness: 0.8; roughness: 0.3" shadow="cast: true"></a-torus>
                    <a-torus radius="0.145" radius-tubular="0.01" color="#1a1a1a" rotation="0 0 0" arc="180" material="metalness: 0.4; roughness: 0.7" shadow="cast: true"></a-torus>
                    <a-box width="0.008" height="0.01" depth="0.05" color="#3a3a3a" position="-0.15 0 0" material="metalness: 0.7" shadow="cast: true"></a-box>
                    <a-box width="0.008" height="0.01" depth="0.05" color="#3a3a3a" position="0.15 0 0" material="metalness: 0.7" shadow="cast: true"></a-box>
                </a-entity>
                
                <a-entity id="leftEarcup" position="-0.15 -0.06 0">
                    <a-cylinder radius="0.008" height="0.05" color="#2a2a2a" position="0 0.025 0" material="metalness: 0.8; roughness: 0.2" shadow="cast: true"></a-cylinder>
                    <a-cylinder radius="0.06" height="0.03" color="#1a1a1a" rotation="90 0 0" material="metalness: 0.7; roughness: 0.4" shadow="cast: true"></a-cylinder>
                    <a-torus radius="0.06" radius-tubular="0.004" color="#444444" rotation="90 0 0" material="metalness: 0.9; roughness: 0.1" shadow="cast: true"></a-torus>
                    <a-sphere radius="0.058" color="#2a2a2a" scale="1 0.4 1" material="metalness: 0.2; roughness: 0.8" shadow="cast: true"></a-sphere>
                    <a-circle radius="0.028" color="#D71920" position="0 0 0.033" material="emissive: #D71920; emissiveIntensity: 0.5; metalness: 0.3" shadow="cast: true"></a-circle>
                    <a-text value="L" color="#FFFFFF" align="center" width="0.18" position="0 0 0.035" scale="0.7 0.7 0.7"></a-text>
                    <a-box width="0.015" height="0.002" depth="0.002" color="#555" position="0 0.025 0.032" shadow="cast: true"></a-box>
                    <a-cylinder radius="0.003" height="0.01" color="#666" position="0.03 -0.025 0.025" rotation="0 0 90" shadow="cast: true"></a-cylinder>
                </a-entity>
                
                <a-entity id="rightEarcup" position="0.15 -0.06 0">
                    <a-cylinder radius="0.008" height="0.05" color="#2a2a2a" position="0 0.025 0" material="metalness: 0.8; roughness: 0.2" shadow="cast: true"></a-cylinder>
                    <a-cylinder radius="0.06" height="0.03" color="#1a1a1a" rotation="90 0 0" material="metalness: 0.7; roughness: 0.4" shadow="cast: true"></a-cylinder>
                    <a-torus radius="0.06" radius-tubular="0.004" color="#444444" rotation="90 0 0" material="metalness: 0.9; roughness: 0.1" shadow="cast: true"></a-torus>
                    <a-sphere radius="0.058" color="#2a2a2a" scale="1 0.4 1" material="metalness: 0.2; roughness: 0.8" shadow="cast: true"></a-sphere>
                    <a-circle radius="0.028" color="#D71920" position="0 0 0.033" material="emissive: #D71920; emissiveIntensity: 0.5; metalness: 0.3" shadow="cast: true"></a-circle>
                    <a-text value="R" color="#FFFFFF" align="center" width="0.18" position="0 0 0.035" scale="0.7 0.7 0.7"></a-text>
                    <a-box width="0.015" height="0.002" depth="0.002" color="#555" position="0 0.025 0.032" shadow="cast: true"></a-box>
                    <a-cylinder radius="0.003" height="0.01" color="#666" position="-0.03 -0.025 0.025" rotation="0 0 90" shadow="cast: true"></a-cylinder>
                </a-entity>
                
                <a-entity light="type: point; color: #00FF00; intensity: 0.8; distance: 0.6" position="0 0 0" animation="property: light.intensity; from: 0.8; to: 0.3; dir: alternate; dur: 1400; loop: true"></a-entity>
                <a-animation id="headphonesFloat" attribute="position" from="2.2 0.92 0.4" to="2.2 0.97 0.4" direction="alternate" dur="2500" repeat="indefinite" easing="easeInOutSine"></a-animation>
            </a-entity>

            <!-- STICKMAN ARTICULADO PROFESIONAL -->
            <a-entity id="stickmanRoot" position="0 0 0" shadow="cast: true; receive: true">
                <a-entity id="pelvis" position="0 0.15 0">
                    <a-sphere radius="0.04" color="#FFE0BD" material="roughness: 0.8" shadow="cast: true"></a-sphere>
                    
                    <a-entity id="spine" position="0 0.3 0">
                        <a-cylinder radius="0.025" height="0.55" color="#4A90E2" material="roughness: 0.6" shadow="cast: true"></a-cylinder>
                        <a-box width="0.02" height="0.02" depth="0.02" color="#3A80D2" position="0 0.15 0" shadow="cast: true"></a-box>
                        <a-box width="0.02" height="0.02" depth="0.02" color="#3A80D2" position="0 -0.15 0" shadow="cast: true"></a-box>
                        
                        <a-entity id="neck" position="0 0.31 0">
                            <a-cylinder radius="0.022" height="0.08" color="#FFE0BD" material="roughness: 0.8" shadow="cast: true"></a-cylinder>
                            
                            <a-entity id="head" position="0 0.12 0">
                                <a-sphere radius="0.11" color="#FFE0BD" material="roughness: 0.7" shadow="cast: true"></a-sphere>
                                <a-sphere radius="0.015" color="#000000" position="-0.04 0.03 0.1" shadow="cast: true"></a-sphere>
                                <a-sphere radius="0.015" color="#000000" position="0.04 0.03 0.1" shadow="cast: true"></a-sphere>
                                <a-sphere radius="0.008" color="#4A90E2" position="-0.04 0.03 0.108" shadow="cast: true"></a-sphere>
                                <a-sphere radius="0.008" color="#4A90E2" position="0.04 0.03 0.108" shadow="cast: true"></a-sphere>
                                <a-sphere radius="0.003" color="#FFFFFF" position="-0.037 0.035 0.112" shadow="cast: true"></a-sphere>
                                <a-sphere radius="0.003" color="#FFFFFF" position="0.043 0.035 0.112" shadow="cast: true"></a-sphere>
                                <a-entity id="mouth" position="0 -0.025 0.1"><a-torus id="mouthShape" radius="0.03" radius-tubular="0.006" color="#000000" rotation="0 0 0" arc="180" shadow="cast: true"></a-torus></a-entity>
                                <a-sphere radius="0.01" color="#FFDBAC" position="0 0.008 0.11" shadow="cast: true"></a-sphere>
                                <a-box width="0.015" height="0.003" depth="0.001" color="#8B4513" position="-0.04 0.055 0.095" rotation="-10 0 -5" shadow="cast: true"></a-box>
                                <a-box width="0.015" height="0.003" depth="0.001" color="#8B4513" position="0.04 0.055 0.095" rotation="-10 0 5" shadow="cast: true"></a-box>
                            </a-entity>
                        </a-entity>
                        
                        <a-entity id="shoulders" position="0 0.265 0">
                            <a-box width="0.24" height="0.04" depth="0.06" color="#4A90E2" material="roughness: 0.6" shadow="cast: true"></a-box>
                            
                            <a-entity id="leftShoulder" position="-0.12 0 0">
                                <a-sphere radius="0.025" color="#FFE0BD" material="roughness: 0.8" shadow="cast: true"></a-sphere>
                                <a-entity id="leftUpperArm" rotation="0 0 18">
                                    <a-cylinder radius="0.018" height="0.22" color="#4A90E2" position="0 -0.11 0" material="roughness: 0.6" shadow="cast: true"></a-cylinder>
                                    <a-sphere radius="0.02" color="#3A80D2" position="0 -0.05 0" shadow="cast: true"></a-sphere>
                                    <a-entity id="leftElbow" position="0 -0.22 0">
                                        <a-sphere radius="0.022" color="#FFE0BD" material="roughness: 0.8" shadow="cast: true"></a-sphere>
                                        <a-entity id="leftForearm" rotation="0 0 6">
                                            <a-cylinder radius="0.015" height="0.2" color="#FFE0BD" position="0 -0.1 0" material="roughness: 0.8" shadow="cast: true"></a-cylinder>
                                            <a-entity id="leftHand" position="0 -0.2 0">
                                                <a-sphere radius="0.028" color="#FFE0BD" material="roughness: 0.8" scale="1 0.8 1.2" shadow="cast: true"></a-sphere>
                                                <a-cylinder radius="0.005" height="0.032" color="#FFE0BD" position="-0.015 -0.02 0.01" rotation="12 0 -18" shadow="cast: true"></a-cylinder>
                                                <a-cylinder radius="0.005" height="0.032" color="#FFE0BD" position="-0.005 -0.02 0.013" rotation="12 0 0" shadow="cast: true"></a-cylinder>
                                                <a-cylinder radius="0.005" height="0.032" color="#FFE0BD" position="0.005 -0.02 0.013" rotation="12 0 0" shadow="cast: true"></a-cylinder>
                                                <a-cylinder radius="0.005" height="0.032" color="#FFE0BD" position="0.015 -0.02 0.01" rotation="12 0 18" shadow="cast: true"></a-cylinder>
                                                <a-cylinder radius="0.005" height="0.022" color="#FFE0BD" position="-0.022 -0.01 0" rotation="0 0 -50" shadow="cast: true"></a-cylinder>
                                            </a-entity>
                                        </a-entity>
                                    </a-entity>
                                </a-entity>
                            </a-entity>
                            
                            <a-entity id="rightShoulder" position="0.12 0 0">
                                <a-sphere radius="0.025" color="#FFE0BD" material="roughness: 0.8" shadow="cast: true"></a-sphere>
                                <a-entity id="rightUpperArm" rotation="0 0 -18">
                                    <a-cylinder radius="0.018" height="0.22" color="#4A90E2" position="0 -0.11 0" material="roughness: 0.6" shadow="cast: true"></a-cylinder>
                                    <a-sphere radius="0.02" color="#3A80D2" position="0 -0.05 0" shadow="cast: true"></a-sphere>
                                    <a-entity id="rightElbow" position="0 -0.22 0">
                                        <a-sphere radius="0.022" color="#FFE0BD" material="roughness: 0.8" shadow="cast: true"></a-sphere>
                                        <a-entity id="rightForearm" rotation="0 0 -6">
                                            <a-cylinder radius="0.015" height="0.2" color="#FFE0BD" position="0 -0.1 0" material="roughness: 0.8" shadow="cast: true"></a-cylinder>
                                            <a-entity id="rightHand" position="0 -0.2 0">
                                                <a-sphere radius="0.028" color="#FFE0BD" material="roughness: 0.8" scale="1 0.8 1.2" shadow="cast: true"></a-sphere>
                                                <a-cylinder radius="0.005" height="0.032" color="#FFE0BD" position="-0.015 -0.02 0.01" rotation="12 0 -18" shadow="cast: true"></a-cylinder>
                                                <a-cylinder radius="0.005" height="0.032" color="#FFE0BD" position="-0.005 -0.02 0.013" rotation="12 0 0" shadow="cast: true"></a-cylinder>
                                                <a-cylinder radius="0.005" height="0.032" color="#FFE0BD" position="0.005 -0.02 0.013" rotation="12 0 0" shadow="cast: true"></a-cylinder>
                                                <a-cylinder radius="0.005" height="0.032" color="#FFE0BD" position="0.015 -0.02 0.01" rotation="12 0 18" shadow="cast: true"></a-cylinder>
                                                <a-cylinder radius="0.005" height="0.022" color="#FFE0BD" position="0.022 -0.01 0" rotation="0 0 50" shadow="cast: true"></a-cylinder>
                                            </a-entity>
                                        </a-entity>
                                    </a-entity>
                                </a-entity>
                            </a-entity>
                        </a-entity>
                    </a-entity>
                    
                    <a-entity id="leftHip" position="-0.05 -0.025 0">
                        <a-sphere radius="0.03" color="#FFE0BD" material="roughness: 0.8" shadow="cast: true"></a-sphere>
                        <a-entity id="leftThigh" rotation="0 0 4">
                            <a-cylinder radius="0.025" height="0.3" color="#2C3E50" position="0 -0.15 0" material="roughness: 0.7" shadow="cast: true"></a-cylinder>
                            <a-sphere radius="0.022" color="#1C2E40" position="0 -0.08 0" shadow="cast: true"></a-sphere>
                            <a-entity id="leftKnee" position="0 -0.3 0">
                                <a-sphere radius="0.028" color="#FFE0BD" material="roughness: 0.8" shadow="cast: true"></a-sphere>
                                <a-entity id="leftCalf" rotation="0 0 -3">
                                    <a-cylinder radius="0.02" height="0.3" color="#2C3E50" position="0 -0.15 0" material="roughness: 0.7" shadow="cast: true"></a-cylinder>
                                    <a-sphere radius="0.018" color="#1C2E40" position="0 -0.08 0" shadow="cast: true"></a-sphere>
                                    <a-entity id="leftAnkle" position="0 -0.3 0">
                                        <a-sphere radius="0.022" color="#FFE0BD" material="roughness: 0.8" shadow="cast: true"></a-sphere>
                                        <a-entity id="leftFoot" position="0 -0.025 0.025">
                                            <a-box width="0.06" height="0.02" depth="0.11" color="#1a1a1a" position="0 -0.01 0" material="roughness: 0.9" shadow="cast: true"></a-box>
                                            <a-box width="0.058" height="0.038" depth="0.075" color="#1a1a1a" position="0 0.008 -0.012" material="roughness: 0.8" shadow="cast: true"></a-box>
                                            <a-box width="0.06" height="0.003" depth="0.11" color="#0a0a0a" position="0 -0.021 0" shadow="cast: true"></a-box>
                                            <a-cylinder radius="0.003" height="0.015" color="#3a3a3a" position="0 -0.012 0.04" shadow="cast: true"></a-cylinder>
                                        </a-entity>
                                    </a-entity>
                                </a-entity>
                            </a-entity>
                        </a-entity>
                    </a-entity>
                    
                    <a-entity id="rightHip" position="0.05 -0.025 0">
                        <a-sphere radius="0.03" color="#FFE0BD" material="roughness: 0.8" shadow="cast: true"></a-sphere>
                        <a-entity id="rightThigh" rotation="0 0 -4">
                            <a-cylinder radius="0.025" height="0.3" color="#2C3E50" position="0 -0.15 0" material="roughness: 0.7" shadow="cast: true"></a-cylinder>
                            <a-sphere radius="0.022" color="#1C2E40" position="0 -0.08 0" shadow="cast: true"></a-sphere>
                            <a-entity id="rightKnee" position="0 -0.3 0">
                                <a-sphere radius="0.028" color="#FFE0BD" material="roughness: 0.8" shadow="cast: true"></a-sphere>
                                <a-entity id="rightCalf" rotation="0 0 3">
                                    <a-cylinder radius="0.02" height="0.3" color="#2C3E50" position="0 -0.15 0" material="roughness: 0.7" shadow="cast: true"></a-cylinder>
                                    <a-sphere radius="0.018" color="#1C2E40" position="0 -0.08 0" shadow="cast: true"></a-sphere>
                                    <a-entity id="rightAnkle" position="0 -0.3 0">
                                        <a-sphere radius="0.022" color="#FFE0BD" material="roughness: 0.8" shadow="cast: true"></a-sphere>
                                        <a-entity id="rightFoot" position="0 -0.025 0.025">
                                            <a-box width="0.06" height="0.02" depth="0.11" color="#1a1a1a" position="0 -0.01 0" material="roughness: 0.9" shadow="cast: true"></a-box>
                                            <a-box width="0.058" height="0.038" depth="0.075" color="#1a1a1a" position="0 0.008 -0.012" material="roughness: 0.8" shadow="cast: true"></a-box>
                                            <a-box width="0.06" height="0.003" depth="0.11" color="#0a0a0a" position="0 -0.021 0" shadow="cast: true"></a-box>
                                            <a-cylinder radius="0.003" height="0.015" color="#3a3a3a" position="0 -0.012 0.04" shadow="cast: true"></a-cylinder>
                                        </a-entity>
                                    </a-entity>
                                </a-entity>
                            </a-entity>
                        </a-entity>
                    </a-entity>
                </a-entity>
            </a-entity>

            <!-- EFECTOS VISUALES -->
            <a-entity id="soundWaves" position="0 0.8 0" visible="false">
                <a-torus radius="0.4" radius-tubular="0.04" color="#FF0000" opacity="0.8" rotation="90 0 0">
                    <a-animation attribute="scale" from="0.5 0.5 0.5" to="3 3 3" dur="2000" repeat="indefinite"></a-animation>
                    <a-animation attribute="opacity" from="0.8" to="0" dur="2000" repeat="indefinite"></a-animation>
                </a-torus>
                <a-torus radius="0.4" radius-tubular="0.04" color="#FF0000" opacity="0.8" rotation="90 0 0">
                    <a-animation attribute="scale" from="0.5 0.5 0.5" to="3 3 3" dur="2000" delay="700" repeat="indefinite"></a-animation>
                    <a-animation attribute="opacity" from="0.8" to="0" dur="2000" delay="700" repeat="indefinite"></a-animation>
                </a-torus>
                <a-torus radius="0.4" radius-tubular="0.04" color="#FF0000" opacity="0.8" rotation="90 0 0">
                    <a-animation attribute="scale" from="0.5 0.5 0.5" to="3 3 3" dur="2000" delay="1400" repeat="indefinite"></a-animation>
                    <a-animation attribute="opacity" from="0.8" to="0" dur="2000" delay="1400" repeat="indefinite"></a-animation>
                </a-torus>
            </a-entity>

            <a-entity id="stressParticles" position="0 0.9 0" visible="false" particle-system="preset: dust; color: #FF0000,#FF6B6B; particleCount: 150; size: 0.025; maxAge: 3; velocityValue: 0.5 0.5 0.5; velocitySpread: 0.4 0.4 0.4; opacity: 0.9"></a-entity>

            <a-entity id="infoPanel" position="0 1.5 0" look-at="#mainCamera" visible="false">
                <a-plane width="2.2" height="0.75" color="#000000" opacity="0.98" shadow="cast: true"></a-plane>
                <a-plane width="2.15" height="0.7" color="#D71920" position="0 0 0.002" shadow="cast: true"></a-plane>
                <a-plane width="2.1" height="0.65" color="#000000" opacity="0.98" position="0 0 0.004"></a-plane>
                <a-text id="infoTitle" value="‚ö†Ô∏è 105 dB - PELIGRO ‚ö†Ô∏è" color="#FFFF00" align="center" width="2.5" position="0 0.2 0.01"></a-text>
                <a-text id="infoSubtitle" value="Exposici√≥n prolongada causa da√±o permanente" color="#FFFFFF" align="center" width="2.3" position="0 -0.15 0.01"></a-text>
            </a-entity>

        </a-entity>

        <a-sky color="#0a0a0a"></a-sky>
    </a-scene>

    <script>
        const CONFIG = { audioFile: 'Sonidos_De_Fabrica.wav', dbThresholds: { safe: 60, warning: 85, danger: 95 } };

        const Router = {
            currentView: 'home',
            init() {
                document.querySelectorAll('[data-nav]').forEach(el => {
                    el.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.navigate(e.currentTarget.getAttribute('data-nav'));
                    });
                });
            },
            navigate(viewId) {
                if (this.currentView === viewId) return;
                const currentEl = document.getElementById(this.currentView);
                if (currentEl) currentEl.classList.remove('active');
                setTimeout(() => {
                    const targetEl = document.getElementById(viewId);
                    if (targetEl) targetEl.classList.add('active');
                    this.handleViewLogic(viewId);
                }, 100);
                this.currentView = viewId;
            },
            handleViewLogic(viewId) {
                switch(viewId) {
                    case 'home':
                        MeterSystem.stop();
                        ARSystem.destroy();
                        break;
                    case 'meter':
                        ARSystem.destroy();
                        setTimeout(() => MeterSystem.start(), 200);
                        break;
                    case 'ar':
                        MeterSystem.stop();
                        setTimeout(() => ARSystem.init(), 300);
                        break;
                }
            }
        };

        const MeterSystem = {
            active: false,
            stream: null,
            audioContext: null,
            analyser: null,
            dataArray: null,
            canvas: null,
            canvasContext: null,
            animationId: null,
            async start() {
                if (this.active) return;
                try {
                    this.stream = await navigator.mediaDevices.getUserMedia({ audio: { echoCancellation: false, noiseSuppression: false, autoGainControl: false } });
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    this.audioContext = new AudioContext();
                    this.analyser = this.audioContext.createAnalyser();
                    this.analyser.fftSize = 2048;
                    this.analyser.smoothingTimeConstant = 0.8;
                    const source = this.audioContext.createMediaStreamSource(this.stream);
                    source.connect(this.analyser);
                    this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);
                    this.canvas = document.getElementById('waveCanvas');
                    this.canvasContext = this.canvas.getContext('2d');
                    this.canvas.width = this.canvas.offsetWidth * window.devicePixelRatio;
                    this.canvas.height = this.canvas.offsetHeight * window.devicePixelRatio;
                    this.canvasContext.scale(window.devicePixelRatio, window.devicePixelRatio);
                    this.active = true;
                    this.draw();
                } catch (error) {
                    console.error('Mic error:', error);
                    alert('‚ùå Necesitas permitir acceso al micr√≥fono');
                    Router.navigate('home');
                }
            },
            stop() {
                if (!this.active) return;
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                    this.animationId = null;
                }
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                    this.stream = null;
                }
                if (this.audioContext) {
                    this.audioContext.close();
                    this.audioContext = null;
                }
                this.active = false;
            },
            draw() {
                if (!this.active) return;
                this.animationId = requestAnimationFrame(() => this.draw());
                this.analyser.getByteFrequencyData(this.dataArray);
                const average = this.dataArray.reduce((a, b) => a + b, 0) / this.dataArray.length;
                let db = Math.floor(20 + average * 0.9);
                db = Math.max(30, Math.min(120, db));
                this.updateUI(db);
                this.drawWaveform();
            },
            updateUI(db) {
                const valueEl = document.getElementById('dbValue');
                const circleEl = document.getElementById('meterCircle');
                const badgeEl = document.getElementById('statusIndicator');
                valueEl.textContent = db;
                circleEl.classList.remove('danger');
                if (db < CONFIG.dbThresholds.safe) {
                    circleEl.style.borderColor = '#34c759';
                    badgeEl.style.background = '#34c759'; 
                    badgeEl.style.color = '#000';
                    badgeEl.textContent = '‚úì SEGURO';
                } else if (db < CONFIG.dbThresholds.danger) {
                    circleEl.style.borderColor = '#ffcc00';
                    badgeEl.style.background = '#ffcc00'; 
                    badgeEl.style.color = '#000';
                    badgeEl.textContent = '‚ö† ALERTA';
                } else {
                    circleEl.style.borderColor = '#ff3b30';
                    circleEl.classList.add('danger');
                    badgeEl.style.background = '#ff3b30'; 
                    badgeEl.style.color = '#fff';
                    badgeEl.textContent = '‚úñ PELIGRO';
                }
            },
            drawWaveform() {
                if (!this.canvasContext) return;
                const ctx = this.canvasContext;
                const w = this.canvas.width / window.devicePixelRatio;
                const h = this.canvas.height / window.devicePixelRatio;
                ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
                ctx.fillRect(0, 0, w, h);
                const barWidth = (w / this.dataArray.length) * 2.5;
                let x = 0;
                for (let i = 0; i < this.dataArray.length; i++) {
                    const normalizedValue = this.dataArray[i] / 255;
                    const barHeight = normalizedValue * h;
                    const lightness = 40 + (normalizedValue * 20);
                    ctx.fillStyle = `hsla(0, 100%, ${lightness}%, ${normalizedValue})`;
                    ctx.fillRect(x, h - barHeight, barWidth, barHeight);
                    x += barWidth + 1;
                }
            }
        };

        const ARSystem = {
            initialized: false,
            audioContext: null,
            source: null,
            filterNode: null,
            gainNode: null,
            isPlaying: false,
            videoStream: null,
            phase: 0,
            hudInterval: null,
            async init() {
                console.log('üé¨ Iniciando AR System');
                const scene = document.getElementById('arScene');
                scene.style.display = 'block';
                await this.startCamera();
                if (!this.initialized) {
                    this.setupEventListeners();
                    this.initialized = true;
                }
                this.resetState();
            },
            async startCamera() {
                try {
                    this.videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } } });
                    const video = document.getElementById('cameraVideo');
                    video.srcObject = this.videoStream;
                    video.style.display = 'block';
                    await video.play();
                    console.log('‚úÖ C√°mara OK');
                } catch (error) {
                    console.log('‚ö†Ô∏è Sin c√°mara, continuando en modo demo');
                }
            },
            destroy() {
                if (this.source) {
                    try { this.source.stop(); } catch(e) {}
                    this.source = null;
                }
                if (this.audioContext) {
                    this.audioContext.close();
                    this.audioContext = null;
                }
                if (this.videoStream) {
                    this.videoStream.getTracks().forEach(track => track.stop());
                    this.videoStream = null;
                }
                if (this.hudInterval) {
                    clearInterval(this.hudInterval);
                    this.hudInterval = null;
                }
                const video = document.getElementById('cameraVideo');
                video.style.display = 'none';
                video.srcObject = null;
                const scene = document.getElementById('arScene');
                scene.style.display = 'none';
                this.isPlaying = false;
                this.phase = 0;
            },
            resetState() {
                document.getElementById('btnStartAR').classList.add('visible');
                document.getElementById('btnNextPhase').classList.remove('visible');
                document.getElementById('btnStartAR').innerHTML = 'üé¨ INICIAR ANIMACI√ìN';
                document.getElementById('btnStartAR').disabled = false;
                document.getElementById('arStatusText').textContent = 'Apunta la c√°mara al suelo para ver la escena 3D';
                document.getElementById('hudValue').textContent = '0 dB';
                document.getElementById('hudFill').style.width = '0%';
                this.isPlaying = false;
                this.phase = 0;
            },
            setupEventListeners() {
                document.getElementById('btnStartAR').addEventListener('click', () => this.startAnimation());
                document.getElementById('btnNextPhase').addEventListener('click', () => this.nextPhase());
            },
            updateHUD(db, color = '#D71920') {
                document.getElementById('hudValue').textContent = `${db} dB`;
                document.getElementById('hudValue').style.color = color;
                const percentage = Math.min(100, (db / 120) * 100);
                document.getElementById('hudFill').style.width = `${percentage}%`;
                if (color === '#34c759') {
                    document.getElementById('hudFill').style.background = 'linear-gradient(90deg, #34c759, #30d158)';
                } else {
                    document.getElementById('hudFill').style.background = 'linear-gradient(90deg, #D71920, #ff6b6b)';
                }
            },
            async loadAudio() {
                try {
                    const AC = window.AudioContext || window.webkitAudioContext;
                    this.audioContext = new AC();
                    const response = await fetch(CONFIG.audioFile);
                    if (!response.ok) throw new Error('No audio');
                    const arrayBuffer = await response.arrayBuffer();
                    const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);
                    this.source = this.audioContext.createBufferSource();
                    this.source.buffer = audioBuffer;
                    this.source.loop = true;
                    this.filterNode = this.audioContext.createBiquadFilter();
                    this.filterNode.type = 'lowpass';
                    this.filterNode.frequency.value = 22000;
                    this.gainNode = this.audioContext.createGain();
                    this.gainNode.gain.value = 1.0;
                    this.source.connect(this.filterNode);
                    this.filterNode.connect(this.gainNode);
                    this.gainNode.connect(this.audioContext.destination);
                    this.source.start(0);
                    return true;
                } catch (error) {
                    console.log('üîá Modo silencioso');
                    return false;
                }
            },
            async startAnimation() {
                if (this.isPlaying) return;
                this.isPlaying = true;
                const btn = document.getElementById('btnStartAR');
                btn.innerHTML = '<span class="loading-spinner"></span> CARGANDO...';
                btn.disabled = true;
                await this.loadAudio();
                btn.classList.remove('visible');
                this.phase1_Suffering();
            },
            nextPhase() {
                if (this.phase === 1) this.phase2_CoveringEars();
                else if (this.phase === 2) this.phase3_Walking();
                else if (this.phase === 3) this.phase4_TakingHeadphones();
                else if (this.phase === 4) this.phase5_WearingProtection();
                else if (this.phase === 5) this.phase6_FinalMessage();
            },
            phase1_Suffering() {
                console.log('üìç FASE 1: Sufrimiento por ruido');
                this.phase = 1;
                document.getElementById('arStatusText').textContent = '‚ö†Ô∏è Exposici√≥n a ruido peligroso - 105 dB';
                document.getElementById('dangerOverlay').classList.add('active');
                document.getElementById('soundWaves').setAttribute('visible', 'true');
                document.getElementById('stressParticles').setAttribute('visible', 'true');
                document.getElementById('infoPanel').setAttribute('visible', 'true');
                const light = document.getElementById('dangerLight');
                light.setAttribute('animation', { property: 'light.intensity', from: 0, to: 4, dir: 'alternate', dur: 700, loop: true });
                const root = document.getElementById('stickmanRoot');
                root.setAttribute('animation__shake', { property: 'rotation', from: '0 0 -5', to: '0 0 5', dir: 'alternate', dur: 80, loop: true });
                const mouth = document.getElementById('mouthShape');
                mouth.setAttribute('rotation', '180 0 0');
                this.startHUDAnimation(105);
                document.getElementById('btnNextPhase').classList.add('visible');
                document.getElementById('arStatusText').textContent = '‚ö†Ô∏è Exposici√≥n a ruido peligroso - Toca CONTINUAR';
            },
            phase2_CoveringEars() {
                console.log('üìç FASE 2: Cubri√©ndose los o√≠dos');
                this.phase = 2;
                document.getElementById('arStatusText').textContent = 'Protecci√≥n insuficiente con las manos';
                const leftShoulder = document.getElementById('leftShoulder');
                const leftUpperArm = document.getElementById('leftUpperArm');
                const rightShoulder = document.getElementById('rightShoulder');
                const rightUpperArm = document.getElementById('rightUpperArm');
                leftShoulder.setAttribute('animation', { property: 'rotation', to: '0 0 95', dur: 1200, easing: 'easeInOutQuad' });
                leftUpperArm.setAttribute('animation', { property: 'rotation', to: '0 0 -110', dur: 1200, easing: 'easeInOutQuad' });
                rightShoulder.setAttribute('animation', { property: 'rotation', to: '0 0 -95', dur: 1200, easing: 'easeInOutQuad' });
                rightUpperArm.setAttribute('animation', { property: 'rotation', to: '0 0 110', dur: 1200, easing: 'easeInOutQuad' });
                this.updateHUD(95);
            },
            phase3_Walking() {
                console.log('üìç FASE 3: Caminando hacia la mesa');
                this.phase = 3;
                document.getElementById('arStatusText').textContent = 'Buscando protecci√≥n auditiva...';
                const root = document.getElementById('stickmanRoot');
                root.removeAttribute('animation__shake');
                const leftShoulder = document.getElementById('leftShoulder');
                const leftUpperArm = document.getElementById('leftUpperArm');
                const rightShoulder = document.getElementById('rightShoulder');
                const rightUpperArm = document.getElementById('rightUpperArm');
                leftShoulder.setAttribute('animation', { property: 'rotation', to: '0 0 18', dur: 700, easing: 'easeInOutQuad' });
                leftUpperArm.setAttribute('animation', { property: 'rotation', to: '0 0 18', dur: 700, easing: 'easeInOutQuad' });
                rightShoulder.setAttribute('animation', { property: 'rotation', to: '0 0 -18', dur: 700, easing: 'easeInOutQuad' });
                rightUpperArm.setAttribute('animation', { property: 'rotation', to: '0 0 -18', dur: 700, easing: 'easeInOutQuad' });
                setTimeout(() => {
                    root.setAttribute('animation__turn', { property: 'rotation', to: '0 -55 0', dur: 1400, easing: 'easeInOutQuad' });
                    setTimeout(() => {
                        const leftThigh = document.getElementById('leftThigh');
                        const rightThigh = document.getElementById('rightThigh');
                        leftThigh.setAttribute('animation', { property: 'rotation', from: '0 0 4', to: '40 0 4', dir: 'alternate', dur: 500, loop: 6, easing: 'easeInOutSine' });
                        rightThigh.setAttribute('animation', { property: 'rotation', from: '0 0 -4', to: '-40 0 -4', dir: 'alternate', dur: 500, loop: 6, easing: 'easeInOutSine' });
                        leftShoulder.setAttribute('animation__swing', { property: 'rotation', from: '0 0 18', to: '40 0 18', dir: 'alternate', dur: 500, loop: 6, easing: 'easeInOutSine' });
                        rightShoulder.setAttribute('animation__swing', { property: 'rotation', from: '0 0 -18', to: '-40 0 -18', dir: 'alternate', dur: 500, loop: 6, easing: 'easeInOutSine' });
                        root.setAttribute('animation__walk', { property: 'position', to: '1 0 0', dur: 3000, easing: 'linear' });
                    }, 1500);
                }, 800);
            },
            phase4_TakingHeadphones() {
                console.log('üìç FASE 4: Tomando auriculares');
                this.phase = 4;
                document.getElementById('arStatusText').textContent = 'Colocando protecci√≥n auditiva...';
                const leftThigh = document.getElementById('leftThigh');
                const rightThigh = document.getElementById('rightThigh');
                const leftShoulder = document.getElementById('leftShoulder');
                const rightShoulder = document.getElementById('rightShoulder');
                leftThigh.removeAttribute('animation');
                rightThigh.removeAttribute('animation');
                leftShoulder.removeAttribute('animation__swing');
                rightShoulder.removeAttribute('animation__swing');
                leftThigh.setAttribute('rotation', '0 0 4');
                rightThigh.setAttribute('rotation', '0 0 -4');
                const rightUpperArm = document.getElementById('rightUpperArm');
                const rightForearm = document.getElementById('rightForearm');
                rightShoulder.setAttribute('animation', { property: 'rotation', to: '0 0 -85', dur: 1400, easing: 'easeInOutQuad' });
                rightUpperArm.setAttribute('animation', { property: 'rotation', to: '0 0 60', dur: 1400, easing: 'easeInOutQuad' });
                rightForearm.setAttribute('animation', { property: 'rotation', to: '0 0 -50', dur: 1400, delay: 500, easing: 'easeInOutQuad' });
                setTimeout(() => {
                    const headphones = document.getElementById('headphonesGroup');
                    headphones.removeAttribute('animation');
                    headphones.setAttribute('animation__approach', { property: 'position', to: '1 0.75 0', dur: 2200, easing: 'easeInOutCubic' });
                    headphones.setAttribute('animation__scale', { property: 'scale', to: '0.75 0.75 0.75', dur: 2200, easing: 'easeInOutCubic' });
                }, 1600);
            },
            phase5_WearingProtection() {
                console.log('üìç FASE 5: Protecci√≥n aplicada');
                this.phase = 5;
                document.getElementById('arStatusText').textContent = '‚úÖ Protecci√≥n auditiva efectiva';
                const headphones = document.getElementById('headphonesGroup');
                headphones.setAttribute('position', '1 0.75 0');
                headphones.setAttribute('scale', '0.7 0.7 0.7');
                headphones.removeAttribute('animation__approach');
                headphones.removeAttribute('animation__scale');
                const leftShoulder = document.getElementById('leftShoulder');
                const rightShoulder = document.getElementById('rightShoulder');
                const rightUpperArm = document.getElementById('rightUpperArm');
                const rightForearm = document.getElementById('rightForearm');
                leftShoulder.setAttribute('animation', { property: 'rotation', to: '0 0 18', dur: 1000 });
                rightShoulder.setAttribute('animation', { property: 'rotation', to: '0 0 -18', dur: 1000 });
                rightUpperArm.setAttribute('animation', { property: 'rotation', to: '0 0 -18', dur: 1000 });
                rightForearm.setAttribute('animation', { property: 'rotation', to: '0 0 -6', dur: 1000 });
                if (this.audioContext && this.filterNode && this.gainNode) {
                    const t = this.audioContext.currentTime;
                    this.filterNode.frequency.exponentialRampToValueAtTime(250, t + 2.5);
                    this.gainNode.gain.exponentialRampToValueAtTime(0.05, t + 2.5);
                }
                document.getElementById('soundWaves').setAttribute('visible', 'false');
                document.getElementById('stressParticles').setAttribute('visible', 'false');
                document.getElementById('dangerOverlay').classList.remove('active');
                const light = document.getElementById('dangerLight');
                light.removeAttribute('animation');
                light.setAttribute('light', 'intensity', 0);
                const mouth = document.getElementById('mouthShape');
                mouth.setAttribute('rotation', '0 0 0');
                document.getElementById('infoTitle').setAttribute('value', '‚úÖ 60 dB - SEGURO ‚úÖ');
                document.getElementById('infoTitle').setAttribute('color', '#00FF00');
                document.getElementById('infoSubtitle').setAttribute('value', 'Protecci√≥n auditiva efectiva aplicada');
                this.updateHUD(60, '#34c759');
            },
            phase6_FinalMessage() {
                console.log('üìç FASE 6: Mensaje final');
                this.phase = 6;
                document.getElementById('arStatusText').textContent = '‚úÖ Simulaci√≥n completada';
                document.getElementById('btnNextPhase').classList.remove('visible');
                const panel = document.getElementById('infoPanel');
                const title = document.getElementById('infoTitle');
                const subtitle = document.getElementById('infoSubtitle');
                panel.children[0].setAttribute('animation', { property: 'height', to: 1.5, dur: 1000 });
                panel.children[1].setAttribute('animation', { property: 'height', to: 1.45, dur: 1000 });
                panel.children[2].setAttribute('animation', { property: 'height', to: 1.4, dur: 1000 });
                setTimeout(() => {
                    title.setAttribute('position', '0 0.6 0.01');
                    subtitle.setAttribute('value', 'Usa protecci√≥n en ambientes >85dB\n\nüè≠ F√°bricas\nüî® Construcci√≥n\nüé∏ Conciertos\n\nTU AUDICI√ìN NO SE REGENERA');
                    subtitle.setAttribute('position', '0 0.1 0.01');
                }, 1100);
            },
            startHUDAnimation(initialDb) {
                if (this.hudInterval) clearInterval(this.hudInterval);
                this.hudInterval = setInterval(() => {
                    if (this.phase <= 2) {
                        const db = 95 + Math.floor(Math.random() * 15);
                        this.updateHUD(db);
                    } else if (this.phase >= 5) {
                        const db = 55 + Math.floor(Math.random() * 10);
                        this.updateHUD(db, '#34c759');
                    }
                }, 250);
            }
        };

        window.addEventListener('load', () => {
            console.log('üöÄ LANXESS AR PRO v18.0 CARGADO');
            Router.init();
        });
    </script>
</body>
</html>
